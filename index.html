<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PUBG Tracker Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; 
      padding: 20px;
      margin: 0;
      background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .header {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
      color: white;
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 100%);
      pointer-events: none;
    }
    
    .header h1 {
      margin: 0 0 10px 0;
      font-size: 32px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .header p {
      margin: 5px 0;
      opacity: 0.95;
      font-size: 16px;
    }
    
    .controls {
      background: white;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      margin-bottom: 30px;
      border: 1px solid rgba(99, 102, 241, 0.1);
    }
    
    .dropdown-container {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .dropdown-container label {
      font-weight: 600;
      color: #4b5563;
      font-size: 14px;
    }
    
    select {
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 15px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
      color: #1f2937;
    }
    
    select:hover {
      border-color: #6366f1;
      background: #f9fafb;
    }
    
    select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .content-section {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      margin-bottom: 30px;
      overflow: hidden;
      border: 1px solid rgba(99, 102, 241, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .content-section:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    
    .section-header {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      padding: 18px 25px;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.3px;
    }
    
    .section-content {
      padding: 25px;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .chart-container {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      height: 300px;
      min-height: 300px;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .chart-container:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
      border-color: #6366f1;
    }
    
    .chart-container canvas {
      width: 100% !important;
      height: 280px !important;
      max-height: 280px;
    }
    
    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #6366f1;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .stat-card:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
      border-left-width: 6px;
    }
    
    .stat-title {
      font-size: 13px;
      color: #6b7280;
      text-transform: uppercase;
      margin-bottom: 8px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #1f2937;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hidden {
      display: none !important;
    }
    
    canvas {
      width: 100% !important;
      height: 100% !important;
    }
    
    .weapons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 25px;
    }
    
    .weapon-chart {
      height: 270px;
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border-radius: 12px;
      padding: 15px;
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .weapon-chart:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
      border-color: #6366f1;
    }

    .player-bio {
      text-align: center;
    }

    .player-bio h2 {
      color: #6366f1;
      margin-bottom: 20px;
      font-size: 28px;
      font-weight: 700;
    }

    .bio-content {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      padding: 25px;
      border-radius: 12px;
      margin: 20px 0;
      border-left: 4px solid #6366f1;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .bio-content p {
      font-size: 16px;
      line-height: 1.8;
      color: #4b5563;
      margin: 0;
      font-style: italic;
    }

    .bio-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-top: 20px;
    }

    .meme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }

    .meme-card {
      background: linear-gradient(135deg, #f87171 0%, #fb923c 100%);
      color: white;
      padding: 25px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(248, 113, 113, 0.3);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .meme-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 35px rgba(248, 113, 113, 0.4);
    }

    .meme-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .meme-value {
      font-size: 32px;
      margin: 12px 0;
      font-weight: 800;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .meme-description {
      font-size: 14px;
      opacity: 0.95;
      font-style: italic;
      line-height: 1.5;
    }

    .records-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }

    .record-card {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      padding: 25px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .record-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 35px rgba(99, 102, 241, 0.4);
    }

    .record-trophy {
      font-size: 40px;
      margin-bottom: 12px;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    }

    .record-title {
      font-size: 16px;
      margin-bottom: 12px;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .record-holder {
      font-size: 22px;
      margin: 12px 0;
      color: #fbbf24;
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .record-value {
      font-size: 28px;
      font-weight: 800;
      margin: 8px 0;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .record-date {
      font-size: 12px;
      color: #e0e0e0;
      margin-top: 10px;
      font-style: italic;
      opacity: 0.9;
    }

    .special-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 5px;
    }

    .special-btn {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .special-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .special-btn:hover::before {
      left: 100%;
    }

    .special-btn:hover {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }

    .special-btn:active, .special-btn.active {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }

    /* Player Selection Styles */
    .player-selection {
      margin-bottom: 25px;
    }

    .player-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 18px;
    }

    .player-btn {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 2px solid #e5e7eb;
      border-radius: 14px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-family: inherit;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      position: relative;
      overflow: hidden;
    }
    
    .player-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .player-btn:hover::before {
      opacity: 1;
    }

    .player-btn:hover {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border-color: #6366f1;
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.2);
    }

    .player-btn.active {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-color: #6366f1;
      color: white;
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
      transform: translateY(-2px);
    }
    
    .player-btn.active::before {
      opacity: 0;
    }

    .player-icon {
      font-size: 32px;
      margin-bottom: 10px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
    }

    .player-name {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .player-role {
      font-size: 12px;
      opacity: 0.85;
      font-weight: 500;
    }

    .player-bio {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 25px;
      width: 100%;
      margin-top: 25px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
    }

    .player-bio h3 {
      color: #6366f1;
      margin: 0 0 18px 0;
      font-size: 22px;
      font-weight: 700;
    }

    .bio-content {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .bio-content p {
      margin: 5px 0;
      line-height: 1.6;
      flex: 1;
      min-width: 250px;
      color: #4b5563;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      .header p {
        font-size: 14px;
      }
      
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-summary {
        grid-template-columns: 1fr;
      }
      
      .player-buttons {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
      }
      
      .dropdown-container {
        flex-direction: column;
        align-items: stretch;
      }
      
      .dropdown-container label {
        margin-top: 10px;
      }
      
      select {
        width: 100%;
      }
    }
    
    /* Loading animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .content-section {
      animation: fadeIn 0.5s ease-out;
    }
    
    /* Smooth scroll */
    html {
      scroll-behavior: smooth;
    }
    
    /* Pulse animation for welcome arrow */
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
        transform: translateY(0);
      }
      50% {
        opacity: 0.7;
        transform: translateY(5px);
      }
    }
  </style>
</head>
<body>
  <div class="header" id="mainHeader" style="display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div style="flex: 1; min-width: 0;">
        <!-- Empty spacer for balance -->
      </div>
      <div style="flex: 2; text-align: center;">
        <h1>🎮 PUBG Performance Dashboard</h1>
        <p>Track your team's performance with detailed statistics and weapon analytics</p>
        <p><small id="lastUpdated">Loading sync information...</small></p>
      </div>
      <div style="flex: 1; display: flex; justify-content: flex-end; min-width: 0;">
        <button id="returnToDashboard" class="special-btn" style="display: none; padding: 24px 48px; font-size: 28px; background: #6c757d; border-color: #6c757d;">
          🏠 Return to Dashboard
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Screen -->
  <div id="welcomeScreen" class="content-section" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%); color: white; border-radius: 16px; padding: 40px; margin: 20px 0; text-align: center; box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3);">
    <h2 style="margin: 0 0 25px 0; font-size: 32px; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">🎮 Welcome to PUBG Performance Tracker!</h2>
    
    <!-- Quick Start Guide and Known Issues Side by Side -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin: 25px 0; max-width: 1200px; margin-left: auto; margin-right: auto;">
      
      <!-- Quick Start Guide -->
      <div style="background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 25px; text-align: left; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
        <h3 style="margin: 0 0 18px 0; color: #fff; font-size: 20px; font-weight: 700;">📖 Quick Start Guide</h3>
        
        <div style="display: flex; flex-direction: column; gap: 15px;">
          <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
            <strong style="font-size: 16px;">👥 Select a Player</strong>
            <p style="margin: 8px 0 0 0; font-size: 14px; opacity: 0.95; line-height: 1.5;">Choose from 6 squad members to view their individual stats and match history</p>
          </div>
          <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
            <strong style="font-size: 16px;">📊 View Statistics</strong>
            <p style="margin: 8px 0 0 0; font-size: 14px; opacity: 0.95; line-height: 1.5;">Use day/match dropdowns to explore detailed performance data and charts</p>
          </div>
          <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
            <strong style="font-size: 16px;">🎯 Special Sections</strong>
            <p style="margin: 8px 0 0 0; font-size: 14px; opacity: 0.95; line-height: 1.5;">Access Meme Dashboard, Team Records, and Changelog anytime</p>
          </div>
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 15px; margin-top: 18px; border: 1px solid rgba(255, 255, 255, 0.3);">
          <strong style="font-size: 15px;">� Sync Times:</strong> Data collection runs around 8 PM, 9 PM, 10 PM, and 11 PM (Prague time) via GitHub Actions
        </div>
      </div>
      
      <!-- Known Issues -->
      <div style="background: rgba(255, 255, 255, 0.15); border-radius: 12px; padding: 25px; text-align: left; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
        <h3 style="margin: 0 0 18px 0; color: #fff; font-size: 20px; font-weight: 700;">⚠️ Known Issues</h3>
        <div style="font-size: 14px; line-height: 1.8;">
          <ul style="margin: 8px 0; padding-left: 25px;">
            <li style="margin-bottom: 12px;"><strong>Weapon Damage:</strong> Includes damage to wildlife (bears) and self/team damage from grenades/vehicles</li>
            <li style="margin-bottom: 12px;"><strong>Team Damage:</strong> Friendly fire and environmental damage is counted in statistics</li>
            <li style="margin-bottom: 12px;"><strong>Filtered Data:</strong> Some weapon damage is filtered in case it exceeds total match damage by at least 100 points</li>
            <li style="margin-bottom: 12px;"><strong>Error Recovery:</strong> When anything breaks - reload the page or click Return to Dashboard button</li>
          </ul>
          <small style="font-style: italic; opacity: 0.8;">These will be addressed in future updates</small>
        </div>
      </div>
    </div>
    
    <!-- Special Sections Buttons -->
    <div style="margin: 30px 0;">
      <h3 style="margin: 0 0 15px 0; font-size: 20px; font-weight: 700; text-shadow: 0 2px 8px rgba(0,0,0,0.2);">🎯 Special Sections</h3>
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <button id="memesBtn" class="special-btn" style="padding: 15px 50px; font-size: 16px; min-width: 250px;">🤡 Meme Dashboard</button>
        <button id="recordsBtn" class="special-btn" style="padding: 15px 50px; font-size: 16px; min-width: 250px;">🏆 Team Records</button>
        <button id="changelogBtn" class="special-btn" style="padding: 15px 50px; font-size: 16px; min-width: 250px;">📋 Changelog</button>
      </div>
    </div>
    
    <!-- Select Player Message -->
    <div style="margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.15); border-radius: 12px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
      <div style="font-size: 22px; font-weight: 700; text-shadow: 0 2px 8px rgba(0,0,0,0.2); animation: pulse 2s ease-in-out infinite;">
        ⬇️ Select a Player Below to Get Started ⬇️
      </div>
    </div>

  </div>

  <!-- Player Selection -->
  <div class="content-section">
    <div class="section-header">👥 Select Player</div>
    <div class="section-content">
      <div class="player-selection">
        <div class="player-buttons">
          <button class="player-btn active" data-player="Kilma9">
            <div class="player-icon">🎮</div>
            <div class="player-name">Kilma9</div>
            <div class="player-role">Main Player</div>
          </button>
          <button class="player-btn" data-player="Mar-0">
            <div class="player-icon">⚔️</div>
            <div class="player-name">Mar-0</div>
            <div class="player-role">Squad Member</div>
          </button>
          <button class="player-btn" data-player="Hyottokko">
            <div class="player-icon">🔥</div>
            <div class="player-name">Hyottokko</div>
            <div class="player-role">Squad Member</div>
          </button>
          <button class="player-btn" data-player="Baron_Frajeris">
            <div class="player-icon">👑</div>
            <div class="player-name">Baron_Frajeris</div>
            <div class="player-role">Squad Member</div>
          </button>
          <button class="player-btn" data-player="codufus">
            <div class="player-icon">🎯</div>
            <div class="player-name">codufus</div>
            <div class="player-role">Squad Member</div>
          </button>
          <button class="player-btn" data-player="Veru_13">
            <div class="player-icon">🛡️</div>
            <div class="player-name">Veru_13</div>
            <div class="player-role">Squad Member</div>
          </button>
        </div>
      </div>
      
      <!-- Player Bio Section - Now below the buttons -->
      <div id="playerBio" class="player-bio hidden">
        <h3 id="bioPlayerName">Kilma9</h3>
        <div id="playerBioContent" class="bio-content">
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>
  
  
  
  <!-- Day/Match Selection Guide -->
  <div id="dayMatchGuide" class="content-section" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border-radius: 16px; padding: 25px; margin: 20px 0; text-align: center; box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3); display: none;">
    <div style="font-size: 18px; font-weight: 700; text-shadow: 0 2px 8px rgba(0,0,0,0.2); animation: pulse 2s ease-in-out infinite;">
      ⬇️ Select a Day Below for Daily Stats or Choose a Specific Match for Details ⬇️
    </div>
  </div>
  
  <div class="controls">
    <div class="dropdown-container">
      <label><strong>Select Day:</strong></label>
      <select id="daySelect">
        <option value="">Choose a day...</option>
      </select>
      <button id="clearDayBtn" class="clear-btn" style="display: none; margin-left: 8px; padding: 4px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">✕ Clear</button>
      
      <label><strong>Team Filter:</strong></label>
      <select id="teamCompositionSelect">
        <option value="all">All Compositions</option>
        <option value="">Loading...</option>
      </select>
      
      <label><strong>Team Size:</strong></label>
      <select id="teamSizeSelect">
        <option value="all">All Sizes</option>
        <option value="solo">👤 Solo</option>
        <option value="duo">👥 Duo</option>
        <option value="squad" selected>👪 Squad</option>
      </select>
      
      <label><strong>Select Match:</strong></label>
      <select id="matchSelect" disabled>
        <option value="">Choose a match...</option>
      </select>
    </div>
  </div>
  
  <div id="dayContent" class="content-section hidden">
    <div class="section-header">Daily Summary</div>
    <div class="section-content">
      <div id="daySummary"></div>
      <div id="dayCharts"></div>
    </div>
  </div>
  
  <div id="matchContent" class="content-section hidden">
    <div class="section-header">Match Details</div>
    <div class="section-content">
      <div id="matchSummary"></div>
      <div id="matchCharts"></div>
    </div>
  </div>

  <div id="bioContent" class="content-section hidden">
    <div class="section-header">Player Biography</div>
    <div class="section-content">
      <div id="bioDetails"></div>
    </div>
  </div>

  <div id="memeContent" class="content-section hidden">
    <div class="section-header">🤡 Meme Dashboard - Hall of Fame</div>
    <div class="section-content">
      <div id="memeDetails"></div>
    </div>
  </div>

  <div id="recordsContent" class="content-section hidden">
    <div class="section-header">🏆 Team Records & Achievements</div>
    <div class="section-content">
      <div id="recordsDetails"></div>
    </div>
  </div>

  <div id="changelogContent" class="content-section hidden">
    <div class="section-header">📋 Changelog</div>
    <div class="section-content">
      <div id="changelogDetails"></div>
    </div>
  </div>

  <script>
    let matchData = [];
    let fullMatchData = []; // Keep full dataset for memes, records, changelog
    let currentCharts = [];
    let cachedRecords = null; // Cache for pre-calculated records
    let currentPlayer = null; // No player selected initially

    // Player data and BIO information
    const playerData = {
      'Kilma9': {
        icon: '🎮',
        role: 'Web Owner',
        bio: `
          <p><strong>� Web Owner</strong></p>
          <p>📊 Primary statistics tracking and dashboard owner</p>
          <p>🏆 Active PUBG player focused on squad gameplay</p>
          <p>⚔️ Prefers strategic positioning and team coordination</p>
          <p>📈 Tracks detailed performance metrics for team improvement</p>
        `,
        dataFile: 'data.json'
      },
      'Mar-0': {
        icon: '⚔️',
        role: 'Squad Member',
        bio: `
          <p><strong>⚔️ Aggressive Fragger</strong></p>
          <p>🔥 Known for high-kill games and aggressive pushes</p>
          <p>🎯 Excellent with assault rifles and SMGs</p>
          <p>🏃 Fast-paced playstyle with strong mechanical skills</p>
          <p>💪 Team's primary entry fragger and damage dealer</p>
        `,
        dataFile: 'data_Mar-0.json'
      },
      'Hyottokko': {
        icon: '🔥',
        role: 'Squad Member',
        bio: `
          <p><strong>🔥 Versatile Player</strong></p>
          <p>🎯 Balanced approach between aggression and strategy</p>
          <p>🛡️ Reliable team player with consistent performance</p>
          <p>📈 Steady improvement and adaptation to team needs</p>
          <p>🤝 Strong communication and tactical awareness</p>
        `,
        dataFile: 'data_Hyottokko.json'
      },
      'Baron_Frajeris': {
        icon: '👑',
        role: 'Squad Member',
        bio: `
          <p><strong>👑 Strategic Mind</strong></p>
          <p>🧠 Tactical player with excellent game sense</p>
          <p>🎯 Sniper specialist with long-range expertise</p>
          <p>🗺️ Map knowledge expert and rotation caller</p>
          <p>🎖️ Clutch player in high-pressure situations</p>
        `,
        dataFile: 'data_Baron_Frajeris.json'
      },
      'codufus': {
        icon: '🎯',
        role: 'Squad Member',
        bio: `
          <p><strong>🎯 Precision Player</strong></p>
          <p>🏹 Accurate shooter with excellent aim</p>
          <p>🔍 Detail-oriented with strong positioning</p>
          <p>🛠️ Equipment and utility specialist</p>
          <p>⚖️ Balanced playstyle adapting to team needs</p>
        `,
        dataFile: 'data_codufus.json'
      },
      'Veru_13': {
        icon: '🛡️',
        role: 'Squad Member',
        bio: `
          <p><strong>🛡️ Support Specialist</strong></p>
          <p>🏥 Team medic and support player</p>
          <p>🚗 Vehicle expert and rotation coordinator</p>
          <p>👁️ Excellent scout with strong awareness</p>
          <p>🤲 Selfless team player focused on squad success</p>
        `,
        dataFile: 'data_Veru_13.json'
      }
    };

    // Utility function to clean weapon names
    function cleanWeaponName(weapon) {
      return weapon.replace(/^(Weap |Proj )/i, '').replace(/_/g, ' ').trim();
    }

    // Utility function to destroy existing charts
    function destroyCharts() {
      currentCharts.forEach(chart => {
        if (chart && typeof chart.destroy === 'function') {
          chart.destroy();
        }
      });
      currentCharts = [];
    }

    // Initialize with default player data
    async function initializeDashboard() {
      // Load main data for special sections even without player selection
      try {
        const timestamp = new Date().getTime();
        const response = await fetch(`data.json?t=${timestamp}`);
        if (response.ok) {
          fullMatchData = await response.json();
          console.log('✅ Main data loaded for special sections:', fullMatchData.length, 'matches');
        }
      } catch (error) {
        console.warn('⚠️ Could not load main data:', error);
      }
      
      // Don't load any player by default - show welcome screen instead
      console.log('Dashboard initialized - showing welcome screen');
      
      // Remove active state from all player buttons
      document.querySelectorAll('.player-btn').forEach(btn => {
        btn.classList.remove('active');
      });
    }

    // Initialize dashboard on page load
    initializeDashboard();

    // Update sync information with Prague time
    async function updateSyncInfo(data) {
      try {
        // Try to fetch the actual sync timestamp first
        let actualSyncTime = null;
        try {
          const syncResponse = await fetch(`/last-sync.json?v=${new Date().getTime()}`);
          if (syncResponse.ok) {
            const syncData = await syncResponse.json();
            actualSyncTime = syncData.pragueTime;
          }
        } catch (syncError) {
          console.log('No sync timestamp file found, using fallback');
        }

        // Find the most recent match
        let latestMatch = null;
        let latestTime = 0;
        
        data.forEach(match => {
          const matchTime = new Date(match.date).getTime();
          if (matchTime > latestTime) {
            latestTime = matchTime;
            latestMatch = match;
          }
        });

        let syncInfo;
        if (actualSyncTime) {
          syncInfo = `Data collected: ${actualSyncTime} (Prague) - ${data.length} matches`;
        } else {
          // Fallback: show page load time
          const pageLoadTime = new Intl.DateTimeFormat('en-GB', {
            timeZone: 'Europe/Prague',
            day: 'numeric',
            month: 'short',
            hour: '2-digit',
            minute: '2-digit'
          }).format(new Date());
          syncInfo = `Page loaded: ${pageLoadTime} (Prague) - ${data.length} matches`;
        }
        
        if (latestMatch) {
          const lastMatchPragueTime = new Intl.DateTimeFormat('en-GB', {
            timeZone: 'Europe/Prague',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }).format(new Date(latestMatch.date));
          
          syncInfo += ` | Latest match: ${lastMatchPragueTime} (Prague)`;
        }

        document.getElementById('lastUpdated').textContent = syncInfo;
      } catch (error) {
        console.error('Error updating sync info:', error);
        document.getElementById('lastUpdated').textContent = `Fresh data with ${data.length} matches!`;
      }
    }

    function populateDayDropdown() {
      const daySelect = document.getElementById('daySelect');
      // Clear existing options except the first one
      daySelect.innerHTML = '<option value="">Choose a day...</option>';
      
      const days = [...new Set(matchData.map(match => match.date.split('T')[0]))].sort().reverse();
      
      days.forEach(day => {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day;
        daySelect.appendChild(option);
      });
    }

    function populateMatchDropdown(selectedDay) {
      const matchSelect = document.getElementById('matchSelect');
      matchSelect.innerHTML = '<option value="">Choose a match...</option>';
      
      const teamComposition = document.getElementById('teamCompositionSelect').value;
      const teamSize = document.getElementById('teamSizeSelect').value;
      const dayMatches = getFilteredMatches(selectedDay, teamComposition, teamSize);
      
      dayMatches.forEach((match, index) => {
        const option = document.createElement('option');
        option.value = index.toString();
        const time = new Date(match.date).toLocaleTimeString();
        const teamNames = match.team.map(p => p.name).join(', ');
        
        option.textContent = `Match ${index + 1} (${time}) - ${teamNames}`;
        matchSelect.appendChild(option);
      });
      
      matchSelect.disabled = dayMatches.length === 0;
    }

    // Get unique team compositions
    function getTeamCompositions() {
      const compositions = new Set();
      matchData.forEach(match => {
        const teamNames = match.team.map(player => player.name).sort().join(', ');
        compositions.add(teamNames);
      });
      return Array.from(compositions).sort();
    }

    // Populate team composition dropdown
    function populateTeamCompositions() {
      const teamSelect = document.getElementById('teamCompositionSelect');
      teamSelect.innerHTML = '<option value="all">All Compositions</option>';
      
      const compositions = getTeamCompositions();
      compositions.forEach(composition => {
        const option = document.createElement('option');
        option.value = composition;
        option.textContent = `${composition} (${getCompositionMatchCount(composition)} matches)`;
        teamSelect.appendChild(option);
      });
    }

    // Get match count for a specific team composition
    function getCompositionMatchCount(composition) {
      return matchData.filter(match => {
        const teamNames = match.team.map(player => player.name).sort().join(', ');
        return teamNames === composition;
      }).length;
    }

    // Filter matches by team composition and team size
    function getFilteredMatches(day, teamComposition = 'all', teamSize = 'squad') {
      let filtered = matchData.filter(match => match.date.split('T')[0] === day);
      
      // Filter by team composition
      if (teamComposition !== 'all') {
        filtered = filtered.filter(match => {
          const teamNames = match.team.map(player => player.name).sort().join(', ');
          return teamNames === teamComposition;
        });
      }
      
      // Filter by team size (solo/duo/squad) - default to squad
      if (teamSize !== 'all') {
        filtered = filtered.filter(match => {
          if (!match.teamSize) {
            // For matches without teamSize data, infer from team length
            const teamLength = match.team.length;
            const inferredSize = teamLength === 1 ? 'solo' : teamLength === 2 ? 'duo' : 'squad';
            return inferredSize === teamSize;
          }
          return match.teamSize === teamSize;
        });
      }
      
      return filtered;
    }

    function showDaySummary(day) {
      destroyCharts();
      const teamComposition = document.getElementById('teamCompositionSelect').value;
      const teamSize = document.getElementById('teamSizeSelect').value;
      const dayMatches = getFilteredMatches(day, teamComposition, teamSize);
      
      console.log('Processing day:', day, 'with', dayMatches.length, 'matches');
      console.log('Filters:', { teamComposition, teamSize });
      
      if (dayMatches.length === 0) {
        document.getElementById('daySummary').innerHTML = `
          <div class="stat-card">
            <div class="stat-title">No Matches Found</div>
            <div class="stat-value">No matches for selected team composition on ${day}</div>
          </div>
        `;
        document.getElementById('dayContent').classList.remove('hidden');
        return;
      }
      
      // Calculate daily aggregated stats
      const playerStats = {};
      dayMatches.forEach(match => {
        match.team.forEach(player => {
          if (!playerStats[player.name]) {
            playerStats[player.name] = {
              kills: 0, damage: 0, headshots: 0, assists: 0, 
              boosts: 0, heals: 0, revives: 0, matches: 0,
              weapons: {}, weaponDamage: {}
            };
          }
          const stats = playerStats[player.name];
          stats.kills += player.kills || 0;
          stats.damage += player.damage || 0;
          stats.headshots += player.headshots || 0;
          stats.assists += player.assists || 0;
          stats.boosts += player.boosts || 0;
          stats.heals += player.heals || 0;
          stats.revives += player.revives || 0;
          stats.matches++;
          
          // Aggregate weapon damage with anomaly filtering
          const playerTotalDamage = player.damage || 0;
          Object.entries(player.weaponDamage || {}).forEach(([weapon, damage]) => {
            if (weapon.includes('Player') || weapon.includes('Effect')) return;
            
            // Filter out anomalous weapon damage where single weapon exceeds total match damage by at least 100 points
            const damageDifference = damage - playerTotalDamage;
            if (damageDifference > 100 && playerTotalDamage > 0) {
              console.warn(`⚠️ Anomalous weapon damage: ${weapon} (${damage}) exceeds total (${playerTotalDamage}) by ${Math.round(damageDifference)}`);
              return;
            }
            
            const cleanName = cleanWeaponName(weapon);
            if (!stats.weaponDamage[cleanName]) stats.weaponDamage[cleanName] = 0;
            stats.weaponDamage[cleanName] += damage;
          });
        });
      });

      console.log('Player stats calculated:', Object.keys(playerStats).length, 'players');

      // Display summary stats
      const summaryHtml = `
        <div class="stats-summary">
          <div class="stat-card">
            <div class="stat-title">Total Matches</div>
            <div class="stat-value">${dayMatches.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Players</div>
            <div class="stat-value">${Object.keys(playerStats).length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Total Kills</div>
            <div class="stat-value">${Object.values(playerStats).reduce((sum, p) => sum + p.kills, 0)}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Total Damage</div>
            <div class="stat-value">${Math.round(Object.values(playerStats).reduce((sum, p) => sum + p.damage, 0)).toLocaleString()}</div>
          </div>
        </div>
      `;
      
      document.getElementById('daySummary').innerHTML = summaryHtml;

      // Create charts
      const chartsHtml = `
        <div class="charts-grid">
          <div class="chart-container"><canvas id="dayKillsChart"></canvas></div>
          <div class="chart-container"><canvas id="dayDamageChart"></canvas></div>
          <div class="chart-container"><canvas id="dayHeadshotsChart"></canvas></div>
          <div class="chart-container"><canvas id="dayAssistsChart"></canvas></div>
        </div>
        <div id="weaponCharts" class="weapons-grid"></div>
      `;
      
      document.getElementById('dayCharts').innerHTML = chartsHtml;

      // Show the day content first
      document.getElementById('dayContent').classList.remove('hidden');

      // Use setTimeout to ensure DOM is ready before creating charts
      setTimeout(() => {
        const players = Object.keys(playerStats);
        console.log('Creating charts for players:', players);
        
        if (players.length === 0) {
          console.error('No players found for charts');
          return;
        }

        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { display: false },
            title: { display: true }
          },
          scales: { 
            y: { beginAtZero: true }
          },
          animation: false // Disable animation for faster rendering
        };

        // Check if canvas elements exist before creating charts
        const killsCanvas = document.getElementById('dayKillsChart');
        const damageCanvas = document.getElementById('dayDamageChart');
        const headshotsCanvas = document.getElementById('dayHeadshotsChart');
        const assistsCanvas = document.getElementById('dayAssistsChart');

        console.log('Canvas elements found:', {
          kills: !!killsCanvas,
          damage: !!damageCanvas,
          headshots: !!headshotsCanvas,
          assists: !!assistsCanvas
        });

        if (!killsCanvas || !damageCanvas || !headshotsCanvas || !assistsCanvas) {
          console.error('Canvas elements not found');
          return;
        }

        // Performance charts
        try {
          console.log('Creating kills chart...');
          const killsChart = new Chart(killsCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                label: 'Kills',
                data: players.map(p => playerStats[p].kills),
                backgroundColor: '#f87171',
                borderColor: '#dc2626',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { 
              ...chartOptions, 
              plugins: { 
                ...chartOptions.plugins, 
                title: { display: true, text: 'Total Kills' } 
              } 
            }
          });
          currentCharts.push(killsChart);
          console.log('Kills chart created successfully');

          console.log('Creating damage chart...');
          const damageChart = new Chart(damageCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                label: 'Damage',
                data: players.map(p => Math.round(playerStats[p].damage)),
                backgroundColor: '#60a5fa',
                borderColor: '#2563eb',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { 
              ...chartOptions, 
              plugins: { 
                ...chartOptions.plugins, 
                title: { display: true, text: 'Total Damage' } 
              } 
            }
          });
          currentCharts.push(damageChart);
          console.log('Damage chart created successfully');

          console.log('Creating headshots chart...');
          const headshotsChart = new Chart(headshotsCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                label: 'Headshots',
                data: players.map(p => playerStats[p].headshots),
                backgroundColor: '#a78bfa',
                borderColor: '#7c3aed',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { 
              ...chartOptions, 
              plugins: { 
                ...chartOptions.plugins, 
                title: { display: true, text: 'Total Headshots' } 
              } 
            }
          });
          currentCharts.push(headshotsChart);
          console.log('Headshots chart created successfully');

          console.log('Creating assists chart...');
          const assistsChart = new Chart(assistsCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                label: 'Assists',
                data: players.map(p => playerStats[p].assists),
                backgroundColor: '#fbbf24',
                borderColor: '#f59e0b',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { 
              ...chartOptions, 
              plugins: { 
                ...chartOptions.plugins, 
                title: { display: true, text: 'Total Assists' } 
              } 
            }
          });
          currentCharts.push(assistsChart);
          console.log('Assists chart created successfully');

          console.log('All main charts created successfully. Total charts:', currentCharts.length);
        } catch (error) {
          console.error('Error creating main charts:', error);
        }

        // Weapon charts for each player
        const weaponChartsContainer = document.getElementById('weaponCharts');
        if (weaponChartsContainer) {
          weaponChartsContainer.innerHTML = '';
          
          players.forEach(player => {
            const weapons = Object.entries(playerStats[player].weaponDamage)
              .filter(([weapon, damage]) => damage > 0)
              .sort((a, b) => b[1] - a[1])
              .slice(0, 10); // Top 10 weapons
            
            if (weapons.length > 0) {
              const chartDiv = document.createElement('div');
              chartDiv.className = 'weapon-chart';
              const cleanPlayerId = player.replace(/[^a-zA-Z0-9]/g, '_');
              chartDiv.innerHTML = `<canvas id="weapon-${cleanPlayerId}"></canvas>`;
              weaponChartsContainer.appendChild(chartDiv);
              
              console.log(`Creating weapon chart for ${player} with ${weapons.length} weapons`);
              
              // Use another setTimeout for weapon charts
              setTimeout(() => {
                const weaponCanvas = document.getElementById(`weapon-${cleanPlayerId}`);
                if (weaponCanvas) {
                  try {
                    const weaponChart = new Chart(weaponCanvas, {
                      type: 'doughnut',
                      data: {
                        labels: weapons.map(([weapon]) => weapon),
                        datasets: [{
                          data: weapons.map(([_, damage]) => Math.round(damage)),
                          backgroundColor: [
                            '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
                            '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43'
                          ]
                        }]
                      },
                      options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: false,
                        plugins: {
                          title: { display: true, text: `${player} - Weapon Damage` },
                          legend: { position: 'bottom', labels: { boxWidth: 12, fontSize: 10 } }
                        }
                      }
                    });
                    currentCharts.push(weaponChart);
                    console.log(`Weapon chart created for ${player}`);
                  } catch (error) {
                    console.error(`Error creating weapon chart for ${player}:`, error);
                  }
                } else {
                  console.error(`Weapon canvas not found for ${player}`);
                }
              }, 200);
            }
          });
        }

        // Final check and debug info
        setTimeout(() => {
          console.log('Final chart count:', currentCharts.length);
          console.log('Chart containers visible:', {
            dayContent: !document.getElementById('dayContent').classList.contains('hidden'),
            chartsGrid: !!document.querySelector('.charts-grid'),
            chartContainers: document.querySelectorAll('.chart-container').length
          });
        }, 500);
      }, 250); // Increased timeout to give more time for DOM rendering
    }

    function showMatchDetails(dayMatches, matchIndex) {
      destroyCharts(); // Only destroy charts, keep day summary visible
      const match = dayMatches[matchIndex];
      
      console.log('Showing match details for match', matchIndex);
      console.log('Match data:', match);
      
      if (!match) {
        console.error('No match found at index', matchIndex);
        document.getElementById('matchSummary').innerHTML = '<div class="stat-card"><div class="stat-title">Error</div><div class="stat-value">Match not found</div></div>';
        return;
      }
      
      // Match summary
      const summaryHtml = `
        <div class="stats-summary">
          <div class="stat-card">
            <div class="stat-title">Match Time</div>
            <div class="stat-value">${new Date(match.date).toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Team Size</div>
            <div class="stat-value">${match.team.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Team Kills</div>
            <div class="stat-value">${match.team.reduce((sum, p) => sum + (p.kills || 0), 0)}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Team Damage</div>
            <div class="stat-value">${Math.round(match.team.reduce((sum, p) => sum + (p.damage || 0), 0)).toLocaleString()}</div>
          </div>
        </div>
      `;
      
      document.getElementById('matchSummary').innerHTML = summaryHtml;

      // Match charts
      const chartsHtml = `
        <div class="charts-grid">
          <div class="chart-container"><canvas id="matchKillsChart"></canvas></div>
          <div class="chart-container"><canvas id="matchDamageChart"></canvas></div>
          <div class="chart-container"><canvas id="matchHeadshotsChart"></canvas></div>
          <div class="chart-container"><canvas id="matchHealsChart"></canvas></div>
        </div>
        <div id="matchWeaponCharts" class="weapons-grid"></div>
      `;
      
      document.getElementById('matchCharts').innerHTML = chartsHtml;

      // Show match content
      const matchContentEl = document.getElementById('matchContent');
      console.log('Match content element:', matchContentEl);
      console.log('Match content classes before:', matchContentEl.className);
      matchContentEl.classList.remove('hidden');
      console.log('Match content classes after:', matchContentEl.className);
      console.log('Match content display:', window.getComputedStyle(matchContentEl).display);

      // Create match charts with delay
      setTimeout(() => {
        const players = match.team.map(p => p.name);
        console.log('Creating match charts for players:', players);
        
        const chartOptions = {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { display: false },
            title: { display: true }
          },
          scales: { 
            y: { beginAtZero: true }
          },
          animation: false
        };

        // Check canvas elements
        const killsCanvas = document.getElementById('matchKillsChart');
        const damageCanvas = document.getElementById('matchDamageChart');
        const headshotsCanvas = document.getElementById('matchHeadshotsChart');
        const healsCanvas = document.getElementById('matchHealsChart');

        console.log('Match canvas elements found:', {
          kills: !!killsCanvas,
          damage: !!damageCanvas,
          headshots: !!headshotsCanvas,
          heals: !!healsCanvas
        });

        if (!killsCanvas || !damageCanvas || !headshotsCanvas || !healsCanvas) {
          console.error('Match canvas elements not found');
          return;
        }

        try {
          // Performance charts
          const killsChart = new Chart(killsCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                data: match.team.map(p => p.kills || 0),
                backgroundColor: '#f87171',
                borderColor: '#dc2626',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Kills' } } }
          });
          currentCharts.push(killsChart);

          const damageChart = new Chart(damageCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                data: match.team.map(p => Math.round(p.damage || 0)),
                backgroundColor: '#60a5fa',
                borderColor: '#2563eb',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Damage' } } }
          });
          currentCharts.push(damageChart);

          const headshotsChart = new Chart(headshotsCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                data: match.team.map(p => p.headshots || 0),
                backgroundColor: '#a78bfa',
                borderColor: '#7c3aed',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Headshots' } } }
          });
          currentCharts.push(headshotsChart);

          const healsChart = new Chart(healsCanvas, {
            type: 'bar',
            data: {
              labels: players,
              datasets: [{
                data: match.team.map(p => (p.heals || 0) + (p.boosts || 0)),
                backgroundColor: '#34d399',
                borderColor: '#10b981',
                borderWidth: 2,
                borderRadius: 8
              }]
            },
            options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Heals + Boosts' } } }
          });
          currentCharts.push(healsChart);

          console.log('Match charts created successfully');
        } catch (error) {
          console.error('Error creating match charts:', error);
        }

        // Individual weapon charts for each player
        const weaponChartsContainer = document.getElementById('matchWeaponCharts');
        if (weaponChartsContainer) {
          weaponChartsContainer.innerHTML = '';
          
          match.team.forEach(player => {
            const playerTotalDamage = player.damage || 0;
            const weapons = Object.entries(player.weaponDamage || {})
              .filter(([weapon, damage]) => {
                // Filter out zero damage, player damage, and anomalous weapon damage
                if (damage <= 0 || weapon.includes('Player') || weapon.includes('Effect')) return false;
                
                // Skip anomalous weapon damage (exceeds total match damage)
                if (damage > playerTotalDamage && playerTotalDamage > 0) {
                  console.warn(`⚠️ Match weapon anomaly: ${weapon} (${damage}) > total (${playerTotalDamage})`);
                  return false;
                }
                
                return true;
              })
              .map(([weapon, damage]) => [cleanWeaponName(weapon), damage])
              .sort((a, b) => b[1] - a[1]);
            
            if (weapons.length > 0) {
              const chartDiv = document.createElement('div');
              chartDiv.className = 'weapon-chart';
              const cleanPlayerId = player.name.replace(/[^a-zA-Z0-9]/g, '_');
              chartDiv.innerHTML = `<canvas id="match-weapon-${cleanPlayerId}"></canvas>`;
              weaponChartsContainer.appendChild(chartDiv);
              
              setTimeout(() => {
                const weaponCanvas = document.getElementById(`match-weapon-${cleanPlayerId}`);
                if (weaponCanvas) {
                  try {
                    const weaponChart = new Chart(weaponCanvas, {
                      type: 'doughnut',
                      data: {
                        labels: weapons.map(([weapon]) => weapon),
                        datasets: [{
                          data: weapons.map(([_, damage]) => Math.round(damage)),
                          backgroundColor: [
                            '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
                            '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43'
                          ]
                        }]
                      },
                      options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: false,
                        plugins: {
                          title: { display: true, text: `${player.name} - Weapon Damage` },
                          legend: { position: 'bottom', labels: { boxWidth: 12, fontSize: 10 } }
                        }
                      }
                    });
                    currentCharts.push(weaponChart);
                  } catch (error) {
                    console.error(`Error creating match weapon chart for ${player.name}:`, error);
                  }
                }
              }, 200);
            }
          });
        }
      }, 250);
    }

    // Event listeners
    document.getElementById('daySelect').addEventListener('change', function() {
      const selectedDay = this.value;
      
      console.log('Day selected:', selectedDay);
      
      if (selectedDay) {
        // Show clear button
        document.getElementById('clearDayBtn').style.display = 'inline-block';
        
        // Hide player BIO when viewing day summary
        document.getElementById('playerBio').classList.add('hidden');
        
        // Show main dashboard when day is selected
        toggleMainDashboard(false);
        
        // Reset bio and special dropdowns
        const bioSelect = document.getElementById('bioSelect');
        if (bioSelect) bioSelect.value = '';
        resetSpecialButtons();
        document.getElementById('bioContent').classList.add('hidden');
        document.getElementById('memeContent').classList.add('hidden');
        document.getElementById('recordsContent').classList.add('hidden');
        document.getElementById('changelogContent').classList.add('hidden');
        
        populateMatchDropdown(selectedDay);
        showDaySummary(selectedDay);
        // Don't hide matchContent, just reset the match dropdown
        document.getElementById('matchSelect').value = '';
        document.getElementById('matchContent').classList.add('hidden');
      } else {
        // Hide clear button
        document.getElementById('clearDayBtn').style.display = 'none';
        
        // If no day selected, show player BIO again
        if (currentPlayer) {
          document.getElementById('playerBio').classList.remove('hidden');
        }
        document.getElementById('matchSelect').disabled = true;
        document.getElementById('matchSelect').value = '';
        document.getElementById('dayContent').classList.add('hidden');
        document.getElementById('matchContent').classList.add('hidden');
        destroyCharts();
      }
    });
    
    // Clear day button handler
    document.getElementById('clearDayBtn').addEventListener('click', function() {
      document.getElementById('daySelect').value = '';
      // Trigger the change event to update UI
      document.getElementById('daySelect').dispatchEvent(new Event('change'));
    });

    // Player selection functionality
    function switchPlayer(playerName) {
      currentPlayer = playerName;
      
      // Destroy any existing charts first
      destroyCharts();
      
      // Hide welcome screen and show main header
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('mainHeader').style.display = 'block';
      
      // Show return to dashboard button
      document.getElementById('returnToDashboard').style.display = 'block';
      
      // Show day/match selection guide
      document.getElementById('dayMatchGuide').style.display = 'block';
      
      // Update active button state
      document.querySelectorAll('.player-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.player === playerName) {
          btn.classList.add('active');
        }
      });
      
      // Reset dashboard state first
      document.getElementById('daySelect').value = '';
      document.getElementById('matchSelect').value = '';
      document.getElementById('clearDayBtn').style.display = 'none';
      document.getElementById('dayContent').classList.add('hidden');
      document.getElementById('matchContent').classList.add('hidden');
      
      // Hide special sections and reset special buttons
      document.getElementById('bioContent').classList.add('hidden');
      document.getElementById('memeContent').classList.add('hidden');
      document.getElementById('recordsContent').classList.add('hidden');
      document.getElementById('changelogContent').classList.add('hidden');
      resetSpecialButtons();
      
      // Load player data (this will call updatePlayerBio after data is loaded)
      // updatePlayerBio will show the playerBio section
      loadPlayerData(playerName);
    }
    
    // Function to return to main dashboard (welcome screen)
    function returnToMainDashboard() {
      // Show welcome screen and hide header
      document.getElementById('welcomeScreen').classList.remove('hidden');
      document.getElementById('mainHeader').style.display = 'none';
      
      // Hide day/match selection guide
      document.getElementById('dayMatchGuide').style.display = 'none';
      
      // Hide all content sections
      document.getElementById('dayContent').classList.add('hidden');
      document.getElementById('matchContent').classList.add('hidden');
      document.getElementById('bioContent').classList.add('hidden');
      document.getElementById('memeContent').classList.add('hidden');
      document.getElementById('recordsContent').classList.add('hidden');
      document.getElementById('changelogContent').classList.add('hidden');
  document.getElementById('playerBio').classList.add('hidden');
      
      // Hide return button
      document.getElementById('returnToDashboard').style.display = 'none';
      
      // Reset header to default
      document.querySelector('.header h1').textContent = '🎮 PUBG Performance Dashboard';
      document.getElementById('lastUpdated').textContent = 'Loading sync information...';
      
      // Remove active state from all player buttons
      document.querySelectorAll('.player-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Reset special buttons
      resetSpecialButtons();
      
      // Clear current player
      currentPlayer = null;
    }

    function updatePlayerBio(playerName) {
      const player = playerData[playerName];
      if (!player) return;
      
      // Update player name
      document.getElementById('bioPlayerName').textContent = playerName;
      
      // Calculate player statistics from full match data
      if (!fullMatchData || fullMatchData.length === 0) {
        document.getElementById('playerBioContent').innerHTML = player.bio;
        document.getElementById('playerBio').classList.remove('hidden');
        console.log('✅ Player BIO shown (no fullMatchData) for', playerName);
        return;
      }
      
      // Filter matches for this specific player
      const playerMatches = fullMatchData.filter(match => 
        match.team && match.team.some(teammate => teammate.name === playerName)
      );
      
      if (playerMatches.length === 0) {
        document.getElementById('playerBioContent').innerHTML = player.bio;
        document.getElementById('playerBio').classList.remove('hidden');
        console.log('✅ Player BIO shown (no matches) for', playerName);
        return;
      }
      
      // Filter to ONLY duo and squad matches
      const duoSquadMatches = playerMatches.filter(match => {
        const teamSize = match.teamSize || (match.team.length === 1 ? 'solo' : match.team.length === 2 ? 'duo' : 'squad');
        return teamSize === 'duo' || teamSize === 'squad';
      });
      
      if (duoSquadMatches.length === 0) {
        document.getElementById('playerBioContent').innerHTML = `
          <div style="text-align: center; padding: 20px;">
            <p>No duo or squad matches found for ${playerName}</p>
            ${player.bio}
          </div>
        `;
        document.getElementById('playerBio').classList.remove('hidden');
        console.log('✅ Player BIO shown (no duo/squad matches) for', playerName);
        return;
      }
      
      // Calculate overall statistics from duo and squad matches only
      let totalKills = 0;
      let totalDamage = 0;
      let totalHeadshots = 0;
      let totalAssists = 0;
      let totalRevives = 0;
      const weaponDamage = {};
      const weaponKills = {}; // Track kills per weapon
      const damageByDay = {}; // Track damage per day for averaging
      
      duoSquadMatches.forEach(match => {
        const playerData = match.team.find(p => p.name === playerName);
        if (playerData) {
          totalKills += playerData.kills || 0;
          totalDamage += playerData.damage || 0;
          totalHeadshots += playerData.headshots || 0;
          totalAssists += playerData.assists || 0;
          totalRevives += playerData.revives || 0;
          
          // Group damage by day for daily average calculation
          const day = match.date.split('T')[0]; // Get YYYY-MM-DD
          if (!damageByDay[day]) {
            damageByDay[day] = { totalDamage: 0, matchCount: 0, date: match.date };
          }
          damageByDay[day].totalDamage += playerData.damage || 0;
          damageByDay[day].matchCount++;
          
          // Aggregate weapon damage with anomaly filtering
          if (playerData.weaponDamage) {
            const playerTotalDamage = playerData.damage || 0;
            Object.entries(playerData.weaponDamage).forEach(([weapon, damage]) => {
              if (weapon.includes('Player') || weapon.includes('Effect')) return;
              
              // Filter out anomalous weapon damage (bug in PUBG API data)
              // Only flag if weapon damage exceeds total damage by at least 100 points
              const damageDifference = damage - playerTotalDamage;
              if (damageDifference > 100 && playerTotalDamage > 0) {
                console.warn(`⚠️ Anomalous weapon damage: ${weapon} (${damage}) exceeds total (${playerTotalDamage}) by ${Math.round(damageDifference)} in match ${match.date}`);
                return;
              }
              
              const cleanName = cleanWeaponName(weapon);
              if (!weaponDamage[cleanName]) weaponDamage[cleanName] = 0;
              weaponDamage[cleanName] += damage;
            });
          }
          
          // Track weapon kills
          if (playerData.weaponKills || playerData.weapons) {
            const killsData = playerData.weaponKills || playerData.weapons || {};
            Object.entries(killsData).forEach(([weapon, kills]) => {
              const cleanName = cleanWeaponName(weapon);
              if (!weaponKills[cleanName]) weaponKills[cleanName] = 0;
              weaponKills[cleanName] += kills;
            });
          }
        }
      });
      
      // Find top 2 weapons
      const topWeapons = Object.entries(weaponDamage)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      const favoriteWeapon1 = topWeapons[0] ? `${topWeapons[0][0]} (${Math.round(topWeapons[0][1]).toLocaleString()} dmg)` : 'N/A';
      const favoriteWeapon2 = topWeapons[1] ? `${topWeapons[1][0]} (${Math.round(topWeapons[1][1]).toLocaleString()} dmg)` : 'N/A';
      const favoriteWeapon3 = topWeapons[2] ? `${topWeapons[2][0]} (${Math.round(topWeapons[2][1]).toLocaleString()} dmg)` : 'N/A';
      const favoriteWeapon4 = topWeapons[3] ? `${topWeapons[3][0]} (${Math.round(topWeapons[3][1]).toLocaleString()} dmg)` : 'N/A';
      const favoriteWeapon5 = topWeapons[4] ? `${topWeapons[4][0]} (${Math.round(topWeapons[4][1]).toLocaleString()} dmg)` : 'N/A';
      
      // Calculate averages
      const avgKills = (totalKills / duoSquadMatches.length).toFixed(1);
      const avgDamage = Math.round(totalDamage / duoSquadMatches.length);
      
      // Calculate special statistics based on player
      let specialStatsHtml = '';
      if (playerName === 'Kilma9') {
        // Track Crossbow and Pistol damage (and kills if available) for Kilma9
        const crossbowDamage = weaponDamage['Crossbow'] || 0;
        const crossbowKills = weaponKills['Crossbow'] || 0;
        
        // Sum all pistol damage (check for various pistol names)
        const pistolDamage = Object.entries(weaponDamage)
          .filter(([weapon]) => {
            const lowerWeapon = weapon.toLowerCase();
            return lowerWeapon.includes('p92') || lowerWeapon.includes('p1911') || 
                   lowerWeapon.includes('p18c') || lowerWeapon.includes('r1895') ||
                   lowerWeapon.includes('r45') || lowerWeapon.includes('scorpion') ||
                   lowerWeapon.includes('pistol') || lowerWeapon.includes('deagle') ||
                   lowerWeapon.includes('sawnoff') || lowerWeapon.includes('nagant');
          })
          .reduce((sum, [, damage]) => sum + damage, 0);
        
        const pistolKills = Object.entries(weaponKills)
          .filter(([weapon]) => {
            const lowerWeapon = weapon.toLowerCase();
            return lowerWeapon.includes('p92') || lowerWeapon.includes('p1911') || 
                   lowerWeapon.includes('p18c') || lowerWeapon.includes('r1895') ||
                   lowerWeapon.includes('r45') || lowerWeapon.includes('scorpion') ||
                   lowerWeapon.includes('pistol') || lowerWeapon.includes('deagle') ||
                   lowerWeapon.includes('sawnoff') || lowerWeapon.includes('nagant');
          })
          .reduce((sum, [, kills]) => sum + kills, 0);
        
        specialStatsHtml = `
          <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
            <p style="margin: 5px 0;"><strong>🎯 Special Weapon Stats:</strong></p>
            <p style="margin: 5px 0; padding-left: 15px;">🏹 Crossbow: ${crossbowKills} kills${crossbowDamage > 0 ? ` (${Math.round(crossbowDamage).toLocaleString()} dmg)` : ''}</p>
            <p style="margin: 5px 0; padding-left: 15px;">🔫 Pistols/Revolvers: ${pistolKills} kills${pistolDamage > 0 ? ` (${Math.round(pistolDamage).toLocaleString()} dmg)` : ''}</p>
          </div>
        `;
      } else if (playerName === 'Baron_Frajeris') {
        // Track Mortar damage and kills for Baron_Frajeris
        const mortarDamage = weaponDamage['Mortar'] || 0;
        const mortarKills = weaponKills['Mortar'] || 0;
        
        specialStatsHtml = `
          <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
            <p style="margin: 5px 0;"><strong>💣 Mortar Statistics:</strong></p>
            <p style="margin: 5px 0; padding-left: 15px;">☠️ Kills: ${mortarKills}</p>
            <p style="margin: 5px 0; padding-left: 15px;">💥 Damage: ${Math.round(mortarDamage).toLocaleString()}</p>
          </div>
        `;
      }
      
      // Convert daily damage data to array and calculate averages per day
      const damagePerDay = Object.entries(damageByDay)
        .map(([day, data]) => ({
          date: day,
          avgDamage: data.totalDamage / data.matchCount,
          matchCount: data.matchCount,
          totalDamage: data.totalDamage
        }))
        .sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Create dynamic bio content
      const bioHtml = `
        <div style="margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #6366f1; font-weight: 700;">📊 Career Statistics</h4>
          <div style="background: #f8f9fa; border-radius: 8px; padding: 15px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div>
                <p style="margin: 5px 0;"><strong>Total Matches:</strong> ${duoSquadMatches.length}</p>
                <p style="margin: 5px 0;"><strong>Total Kills:</strong> ${totalKills} (avg: ${avgKills})</p>
                <p style="margin: 5px 0;"><strong>Total Damage:</strong> ${Math.round(totalDamage).toLocaleString()} (avg: ${avgDamage.toLocaleString()})</p>
              </div>
              <div>
                <p style="margin: 5px 0;"><strong>Total Headshots:</strong> ${totalHeadshots}</p>
                <p style="margin: 5px 0;"><strong>Total Assists:</strong> ${totalAssists}</p>
                <p style="margin: 5px 0;"><strong>Total Revives:</strong> ${totalRevives}</p>
              </div>
            </div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
              <p style="margin: 5px 0;"><strong>🎯 Favorite Weapons:</strong></p>
              <p style="margin: 5px 0; padding-left: 15px;">🥇 #1: ${favoriteWeapon1}</p>
              <p style="margin: 5px 0; padding-left: 15px;">🥈 #2: ${favoriteWeapon2}</p>
              <p style="margin: 5px 0; padding-left: 15px;">🥉 #3: ${favoriteWeapon3}</p>
              <p style="margin: 5px 0; padding-left: 15px;">🏅 #4: ${favoriteWeapon4}</p>
              <p style="margin: 5px 0; padding-left: 15px;">🎖️ #5: ${favoriteWeapon5}</p>
            </div>
            ${specialStatsHtml}
          </div>
        </div>
        
        <div style="margin-top: 20px;">
          <p style="margin: 0 0 5px 0; font-size: 12px; color: #666; font-style: italic;">Daily average = total damage on that day ÷ number of games played</p>
          <div style="background: white; border-radius: 8px; padding: 15px; height: 250px;">
            <canvas id="playerDamageTrendChart"></canvas>
          </div>
        </div>
        
        <div style="margin-top: 20px;">
          <h4 style="margin: 0 0 12px 0; color: #6366f1; font-weight: 700;">👥 All Players Daily Average Comparison</h4>
          
          <!-- Time range selector -->
          <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: center;">
            <label style="font-size: 14px; font-weight: bold; margin-right: 10px;">Time Range:</label>
            <button id="range1Day" class="time-range-btn" style="margin: 0 5px; padding: 8px 16px; border: 2px solid #6366f1; background: white; border-radius: 8px; cursor: pointer; font-size: 13px; transition: all 0.3s ease;">Last Day</button>
            <button id="range7Days" class="time-range-btn active" style="margin: 0 5px; padding: 8px 16px; border: 2px solid #6366f1; background: #6366f1; color: white; border-radius: 8px; cursor: pointer; font-size: 13px; transition: all 0.3s ease;">Last Week</button>
            <button id="range14Days" class="time-range-btn" style="margin: 0 5px; padding: 8px 16px; border: 2px solid #6366f1; background: white; border-radius: 8px; cursor: pointer; font-size: 13px; transition: all 0.3s ease;">Last 2 Weeks</button>
            <button id="range30Days" class="time-range-btn" style="margin: 0 5px; padding: 8px 16px; border: 2px solid #6366f1; background: white; border-radius: 8px; cursor: pointer; font-size: 13px; transition: all 0.3s ease;">Last Month</button>
          </div>
          
          <div style="background: white; border-radius: 8px; padding: 15px; height: 300px;">
            <canvas id="allPlayersDamageTrendChart"></canvas>
          </div>
        </div>
      `;
      
      document.getElementById('playerBioContent').innerHTML = bioHtml;
      document.getElementById('playerBio').classList.remove('hidden');
      console.log('✅ Player BIO shown for', playerName, '- playerBio hidden class removed');
      
      // Create damage trend chart
      setTimeout(() => {
        const canvas = document.getElementById('playerDamageTrendChart');
        if (!canvas) {
          console.error('Player damage trend canvas not found');
          return;
        }
        
        // Destroy existing chart if any
        const existingChart = Chart.getChart(canvas);
        if (existingChart) {
          existingChart.destroy();
        }
        
        new Chart(canvas, {
          type: 'line',
          data: {
            labels: damagePerDay.map(d => d.date),
            datasets: [{
              label: 'Avg Damage per Day',
              data: damagePerDay.map(d => d.avgDamage),
              borderColor: '#6366f1',
              backgroundColor: 'rgba(99, 102, 241, 0.1)',
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 5,
              pointHoverRadius: 8,
              pointBackgroundColor: '#6366f1',
              pointBorderColor: '#fff',
              pointBorderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top'
              },
              tooltip: {
                callbacks: {
                  title: (items) => {
                    const index = items[0].dataIndex;
                    return damagePerDay[index].date;
                  },
                  label: (item) => {
                    const index = item.dataIndex;
                    const dayData = damagePerDay[index];
                    return [
                      `Avg Damage: ${Math.round(dayData.avgDamage).toLocaleString()}`,
                      `Total Damage: ${Math.round(dayData.totalDamage).toLocaleString()}`,
                      `Matches: ${dayData.matchCount}`
                    ];
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Average Damage'
                }
              },
              x: {
                title: {
                  display: true,
                  text: 'Date'
                },
                ticks: {
                  maxRotation: 45,
                  minRotation: 45
                }
              }
            }
          }
        });
        
        // Create all-players comparison chart with default 7-day range
        createAllPlayersComparisonChart(7);
        
        // Add event listeners for time range buttons
        document.getElementById('range1Day').addEventListener('click', function() {
          document.querySelectorAll('.time-range-btn').forEach(btn => {
            btn.style.background = 'white';
            btn.style.color = '#6366f1';
          });
          this.style.background = '#6366f1';
          this.style.color = 'white';
          createAllPlayersComparisonChart(1);
        });
        
        document.getElementById('range7Days').addEventListener('click', function() {
          document.querySelectorAll('.time-range-btn').forEach(btn => {
            btn.style.background = 'white';
            btn.style.color = '#6366f1';
          });
          this.style.background = '#6366f1';
          this.style.color = 'white';
          createAllPlayersComparisonChart(7);
        });
        
        document.getElementById('range14Days').addEventListener('click', function() {
          document.querySelectorAll('.time-range-btn').forEach(btn => {
            btn.style.background = 'white';
            btn.style.color = '#6366f1';
          });
          this.style.background = '#6366f1';
          this.style.color = 'white';
          createAllPlayersComparisonChart(14);
        });
        
        document.getElementById('range30Days').addEventListener('click', function() {
          document.querySelectorAll('.time-range-btn').forEach(btn => {
            btn.style.background = 'white';
            btn.style.color = '#6366f1';
          });
          this.style.background = '#6366f1';
          this.style.color = 'white';
          createAllPlayersComparisonChart(30);
        });
      }, 100);
    }
    
    // Function to create all-players daily average damage comparison chart
    function createAllPlayersComparisonChart(daysToShow = 7) {
      const canvas = document.getElementById('allPlayersDamageTrendChart');
      if (!canvas) {
        console.error('All players damage trend canvas not found');
        return;
      }
      
      // Destroy existing chart if any
      const existingChart = Chart.getChart(canvas);
      if (existingChart) {
        existingChart.destroy();
      }
      
      if (!fullMatchData || fullMatchData.length === 0) {
        console.warn('No full match data available for all-players chart');
        return;
      }
      
      // Only include the 6 tracked players (from playerData object)
      const playerNames = Object.keys(playerData);
      console.log('Creating all-players chart for tracked players:', playerNames, `(${daysToShow} days)`);
      
      // Generate continuous date range for the selected period
      const today = new Date();
      const startDate = new Date(today);
      startDate.setDate(today.getDate() - daysToShow + 1);
      
      const allDays = [];
      for (let d = new Date(startDate); d <= today; d.setDate(d.getDate() + 1)) {
        allDays.push(d.toISOString().split('T')[0]);
      }
      
      console.log('Date range:', allDays[0], 'to', allDays[allDays.length - 1]);
      
      // Calculate daily averages for each player
      const playerDailyData = {};
      
      playerNames.forEach(playerName => {
        // Filter to duo/squad matches for this player
        const playerMatches = fullMatchData.filter(match => {
          if (!match.team) return false;
          const teamSize = match.teamSize || (match.team.length === 1 ? 'solo' : match.team.length === 2 ? 'duo' : 'squad');
          const isDuoOrSquad = teamSize === 'duo' || teamSize === 'squad';
          const hasPlayer = match.team.some(p => p.name === playerName);
          
          // Also filter by date range
          const matchDate = match.date.split('T')[0];
          const isInRange = matchDate >= allDays[0] && matchDate <= allDays[allDays.length - 1];
          
          return isDuoOrSquad && hasPlayer && isInRange;
        });
        
        const damageByDay = {};
        
        playerMatches.forEach(match => {
          const playerData = match.team.find(p => p.name === playerName);
          if (playerData) {
            const day = match.date.split('T')[0];
            
            if (!damageByDay[day]) {
              damageByDay[day] = { totalDamage: 0, matchCount: 0 };
            }
            damageByDay[day].totalDamage += playerData.damage || 0;
            damageByDay[day].matchCount++;
          }
        });
        
        playerDailyData[playerName] = damageByDay;
      });
      
      // Color palette for different players
      const colors = [
        { border: '#667eea', bg: '#667eea' },   // Purple
        { border: '#ff6b6b', bg: '#ff6b6b' },   // Red
        { border: '#4ecdc4', bg: '#4ecdc4' },    // Teal
        { border: '#f7b731', bg: '#f7b731' },    // Yellow
        { border: '#5f27cd', bg: '#5f27cd' },     // Dark Purple
        { border: '#26de81', bg: '#26de81' }     // Green
      ];
      
      // Create datasets for each player
      const datasets = playerNames.map((playerName, index) => {
        const color = colors[index % colors.length];
        const dailyData = playerDailyData[playerName];
        
        // Map each day to its average damage (or 0 if player didn't play that day)
        const data = allDays.map(day => {
          if (dailyData[day]) {
            return dailyData[day].totalDamage / dailyData[day].matchCount;
          }
          return 0; // No data for this day - show as 0 (no bar will appear)
        });
        
        return {
          label: playerName,
          data: data,
          backgroundColor: color.bg,
          borderColor: color.border,
          borderWidth: 1
        };
      });
      
      new Chart(canvas, {
        type: 'bar',
        data: {
          labels: allDays,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              callbacks: {
                label: (context) => {
                  const playerName = context.dataset.label;
                  const avgDamage = context.parsed.y;
                  if (avgDamage === 0) return null;
                  
                  const day = allDays[context.dataIndex];
                  const dailyData = playerDailyData[playerName][day];
                  
                  if (!dailyData) return null;
                  
                  return [
                    `${playerName}: ${Math.round(avgDamage).toLocaleString()} avg`,
                    `  (${dailyData.matchCount} matches)`
                  ];
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Average Damage per Day'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Date'
              },
              ticks: {
                maxRotation: 45,
                minRotation: 45
              }
            }
          }
        }
      });
    }

    async function loadPlayerData(playerName) {
      const player = playerData[playerName];
      if (!player) return;
      
      try {
        console.log(`📊 Loading data for ${playerName}...`);
        
        // Add cache busting with timestamp
        const timestamp = new Date().getTime();
        
        // Try to load player-specific file first, fallback to main data.json
        let response;
        let dataFile = player.dataFile;
        
        try {
          response = await fetch(`${dataFile}?t=${timestamp}`);
          if (!response.ok) throw new Error('Player file not found');
        } catch (error) {
          console.log(`⚠️ Player-specific file not found for ${playerName}, trying main data.json...`);
          dataFile = 'data.json';
          response = await fetch(`${dataFile}?t=${timestamp}`);
          
          if (!response.ok) {
            throw new Error(`Failed to load any data file: ${response.status}`);
          }
        }
        
        const allData = await response.json();
        
        // Always keep the full dataset for global functions (memes, records, changelog)
        fullMatchData = allData;
        
        // Filter data for the specific player if using main data.json
        if (dataFile === 'data.json' && playerName !== 'Kilma9') {
          matchData = allData.filter(match => 
            match.team && match.team.some(teammate => teammate.name === playerName)
          );
          console.log(`✅ Filtered ${matchData.length} matches for ${playerName} from main data`);
        } else {
          matchData = allData;
          console.log(`✅ Loaded ${matchData.length} matches for ${playerName}`);
        }
        
        // Update dashboard title
        document.querySelector('.header h1').textContent = `🎮 ${playerName}'s PUBG Performance Dashboard`;
        
        // Update sync information
        await updateSyncInfo(matchData);
        
        // Update player bio with loaded data
        updatePlayerBio(playerName);
        
        // Clear cached records to force recalculation with full dataset
        cachedRecords = null;
        
        // Repopulate dropdowns and data
        populateDayDropdown();
        populateTeamCompositions();
        
      } catch (error) {
        console.error(`❌ Error loading data for ${playerName}:`, error);
        matchData = [];
        
        // Show error message
        document.getElementById('daySummary').innerHTML = `
          <div class="stat-card">
            <div class="stat-title">No Data Available</div>
            <div class="stat-value">Data for ${playerName} not found or failed to load</div>
            <div style="margin-top: 10px; font-size: 12px; color: #666;">
              Make sure the data collection has been run for this player
            </div>
          </div>
        `;
      }
    }

    // Add event listeners for player buttons
    document.querySelectorAll('.player-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const playerName = btn.dataset.player;
        
        // If clicking the same player again, just reset view to show BIO
        if (currentPlayer === playerName) {
          // Reset to player's main view (show BIO, hide day/match content)
          document.getElementById('daySelect').value = '';
          document.getElementById('matchSelect').value = '';
          document.getElementById('clearDayBtn').style.display = 'none';
          document.getElementById('dayContent').classList.add('hidden');
          document.getElementById('matchContent').classList.add('hidden');
          document.getElementById('playerBio').classList.remove('hidden');
          destroyCharts();
        } else {
          // Switch to different player
          switchPlayer(playerName);
        }
      });
    });
    
    // Return to dashboard button event listener
    document.getElementById('returnToDashboard').addEventListener('click', function() {
      location.reload();
    });

    // Team composition filter event listener
    document.getElementById('teamCompositionSelect').addEventListener('change', function() {
      const selectedDay = document.getElementById('daySelect').value;
      
      if (selectedDay) {
        populateMatchDropdown(selectedDay);
        showDaySummary(selectedDay);
        // Reset match selection when composition changes
        document.getElementById('matchSelect').value = '';
        document.getElementById('matchContent').classList.add('hidden');
      }
    });

    // Team size filter event listener
    document.getElementById('teamSizeSelect').addEventListener('change', function() {
      const selectedDay = document.getElementById('daySelect').value;
      
      if (selectedDay) {
        populateMatchDropdown(selectedDay);
        showDaySummary(selectedDay);
        document.getElementById('matchSelect').value = '';
        document.getElementById('matchContent').classList.add('hidden');
      }
    });

    document.getElementById('matchSelect').addEventListener('change', function() {
      const selectedDay = document.getElementById('daySelect').value;
      const matchIndex = parseInt(this.value);
      
      console.log('Match selected:', matchIndex, 'for day:', selectedDay);
      
      if (!isNaN(matchIndex) && selectedDay) {
        // Reset bio and special dropdowns
        const bioSelect = document.getElementById('bioSelect');
        if (bioSelect) bioSelect.value = '';
        resetSpecialButtons();
        document.getElementById('bioContent').classList.add('hidden');
        document.getElementById('memeContent').classList.add('hidden');
        document.getElementById('recordsContent').classList.add('hidden');
        document.getElementById('changelogContent').classList.add('hidden');
        
        // Hide day summary when match is selected
        document.getElementById('dayContent').classList.add('hidden');
        
        const teamComposition = document.getElementById('teamCompositionSelect').value;
        const teamSize = document.getElementById('teamSizeSelect').value;
        const dayMatches = getFilteredMatches(selectedDay, teamComposition, teamSize);
        showMatchDetails(dayMatches, matchIndex);
      } else {
        document.getElementById('matchContent').classList.add('hidden');
        // Show day summary again when no match is selected
        if (selectedDay) {
          document.getElementById('dayContent').classList.remove('hidden');
        }
        // Re-destroy only match charts, keep day charts
        const matchCharts = currentCharts.filter(chart => 
          chart.canvas && chart.canvas.id && chart.canvas.id.includes('match')
        );
        matchCharts.forEach(chart => {
          if (chart && typeof chart.destroy === 'function') {
            chart.destroy();
          }
        });
        currentCharts = currentCharts.filter(chart => 
          !(chart.canvas && chart.canvas.id && chart.canvas.id.includes('match'))
        );
      }
    });

    // Function to hide/show main dashboard sections
    function toggleMainDashboard(hide = false) {
      const mainSections = ['dayContent', 'matchContent'];
      
      if (hide) {
        // Hide main sections when Bio/Special is active
        mainSections.forEach(sectionId => {
          document.getElementById(sectionId).classList.add('hidden');
        });
      } else {
        // Show main sections when returning to normal mode
        mainSections.forEach(sectionId => {
          document.getElementById(sectionId).classList.remove('hidden');
        });
      }
    }

    // BIO dropdown event listener
    const bioSelectEl = document.getElementById('bioSelect');
    if (bioSelectEl) {
      bioSelectEl.addEventListener('change', function() {
        const selectedPlayer = this.value;
        
        console.log('Player BIO selected:', selectedPlayer);
        
        if (selectedPlayer) {
          // Hide main dashboard when showing bio
          toggleMainDashboard(true);
          showPlayerBio(selectedPlayer);
          
          // Reset other dropdowns
          resetSpecialButtons();
          document.getElementById('memeContent').classList.add('hidden');
        document.getElementById('recordsContent').classList.add('hidden');
        document.getElementById('changelogContent').classList.add('hidden');
      } else {
        // Show main dashboard when no bio selected
        toggleMainDashboard(false);
        document.getElementById('bioContent').classList.add('hidden');
      }
    });
    }

    // Helper function to reset special button states
    function resetSpecialButtons() {
      document.querySelectorAll('.special-btn').forEach(btn => {
        btn.classList.remove('active');
      });
    }

    // Helper function to hide all special sections
    function hideAllSpecialSections() {
      document.getElementById('memeContent').classList.add('hidden');
      document.getElementById('recordsContent').classList.add('hidden');
      document.getElementById('changelogContent').classList.add('hidden');
    }

    // Memes button event listener
    document.getElementById('memesBtn').addEventListener('click', function() {
      console.log('Memes button clicked');
      
      // Reset other buttons and hide all sections first
      resetSpecialButtons();
      hideAllSpecialSections();
      
      // Set this button as active
      this.classList.add('active');
      
      // Show main header if hidden
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('mainHeader').style.display = 'block';
      document.getElementById('returnToDashboard').style.display = 'block';
      
      // Hide main dashboard when showing special sections
      toggleMainDashboard(true);
      showMemesDashboard();
      
      // Reset bio dropdown
      const bioSelect = document.getElementById('bioSelect');
      if (bioSelect) bioSelect.value = '';
      document.getElementById('bioContent').classList.add('hidden');
    });

    // Records button event listener
    document.getElementById('recordsBtn').addEventListener('click', function() {
      console.log('Records button clicked');
      
      // Reset other buttons and hide all sections first
      resetSpecialButtons();
      hideAllSpecialSections();
      
      // Set this button as active
      this.classList.add('active');
      
      // Show main header if hidden
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('mainHeader').style.display = 'block';
      document.getElementById('returnToDashboard').style.display = 'block';
      
      // Hide main dashboard when showing special sections
      toggleMainDashboard(true);
      showTeamRecords();
      
      // Reset bio dropdown
      const bioSelect = document.getElementById('bioSelect');
      if (bioSelect) bioSelect.value = '';
      document.getElementById('bioContent').classList.add('hidden');
    });

    // Changelog button event listener
    document.getElementById('changelogBtn').addEventListener('click', function() {
      console.log('Changelog button clicked');
      
      // Reset other buttons and hide all sections first
      resetSpecialButtons();
      hideAllSpecialSections();
      
      // Set this button as active
      this.classList.add('active');
      
      // Show main header if hidden
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('mainHeader').style.display = 'block';
      document.getElementById('returnToDashboard').style.display = 'block';
      
      // Hide main dashboard when showing special sections
      toggleMainDashboard(true);
      showChangelog();
      
      // Reset bio dropdown
      const bioSelect = document.getElementById('bioSelect');
      if (bioSelect) bioSelect.value = '';
      document.getElementById('bioContent').classList.add('hidden');
    });

    // Function to show player bio
    function showPlayerBio(playerName) {
      const bioData = {
        'Kilma9': {
          description: 'Somehow crashes every vehicle! 🚗💥 Maybe stick to ARs instead of SMGs and try DMRs over SRs - your teammates\' ears will thank you!',
          favoriteGun: 'Gliders',
          funnyNote: 'Driving instructor\'s worst nightmare'
        },
        'Veru_13': {
          description: 'The queen of all range engagements who dominates every distance! 👑🎯 AUG for close spraying, Mini14 for long-range sniping - true master of battlefield versatility!',
          favoriteGun: 'AUG & Mini14',
          funnyNote: 'Range? What range?'
        },
        'Mar-0': {
          description: 'The landing strategist who always picks the "perfect" spot... right between 5 enemy teams! 🪂💀 At least he has an AUG to fight his way out!',
          favoriteGun: 'AUG',
          funnyNote: 'Hot zone magnet'
        },
        'Hyottokko': {
          description: 'Son of ancient Greek gods with divine bloodline... too bad he forgot to bring those powers into PUBG! ⚡️🏛️ The gods are still waiting for him to awaken!',
          favoriteGun: 'Kar98k',
          funnyNote: 'Dormant deity'
        },
        'Baron_Frajeris': {
          description: 'The legendary hoarder who carries zero ammo and no heals, but somehow has 200 mortar shells! 💣🎒 "Need ammo?" - "Sorry, only explosives!"',
          favoriteGun: 'Mortars',
          funnyNote: 'Explosive logistics expert'
        },
        'codufus': {
          description: 'Bad mother father from the beautiful island of Corsica! 🏝️😎 Feels right at home on Paramo map - another volcanic island where he can spray enemies among familiar terrain and architecture!',
          favoriteGun: 'AUG',
          funnyNote: 'Volcanic island warrior'
        }
      };

      const player = bioData[playerName] || {
        description: 'Mysterious player with classified intel.',
        favoriteGun: 'Pan',
        funnyNote: 'Identity unknown'
      };

      const bioHtml = `
        <div class="player-bio">
          <h2>🎮 ${playerName}</h2>
          <div class="bio-content">
            <p>${player.description}</p>
          </div>
          <div class="bio-stats">
            <div class="stat-card">
              <div class="stat-title">Favorite Gun</div>
              <div class="stat-value">🔫 ${player.favoriteGun}</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Status</div>
              <div class="stat-value">Active Player</div>
            </div>
            <div class="stat-card">
              <div class="stat-title">Specialty</div>
              <div class="stat-value">${player.funnyNote}</div>
            </div>
          </div>
        </div>
      `;

      document.getElementById('bioDetails').innerHTML = bioHtml;
      document.getElementById('bioContent').classList.remove('hidden');
    }

    // Function to show Memes Dashboard
    function showMemesDashboard() {
      const memeStats = calculateMemeStats();
      
      const memeHtml = `
        <div class="meme-grid">
          <div class="meme-card">
            <div class="meme-title">🚗💥 Vehicle Destruction Expert</div>
            <div class="meme-value">Kilma9</div>
            <div class="meme-description">"I swear the glider controls are different!"</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">🎒 Explosive Hoarder Award</div>
            <div class="meme-value">Baron_Frajeris</div>
            <div class="meme-description">"Need ammo? I have mortars!"</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">🪂 Hot Zone Magnet</div>
            <div class="meme-value">Mar-0</div>
            <div class="meme-description">"This looks like a quiet spot..." *5 teams land*</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">⚡ Sleeping Deity</div>
            <div class="meme-value">Hyottokko</div>
            <div class="meme-description">"Gods don't need aim assist"</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">👑 Range Empress</div>
            <div class="meme-value">Veru_13</div>
            <div class="meme-description">"Distance is just a number"</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">💊 Most Likely to Need Revive</div>
            <div class="meme-value">${memeStats.mostRevives}</div>
            <div class="meme-description">"I was checking the map!"</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">🔥 Damage Dealer Supreme</div>
            <div class="meme-value">${memeStats.topDamager}</div>
            <div class="meme-description">Making enemies regret their life choices</div>
          </div>
          
          <div class="meme-card">
            <div class="meme-title">🎯 Kill Stealer Extraordinaire</div>
            <div class="meme-value">${memeStats.killStealer}</div>
            <div class="meme-description">"I was helping!"</div>
          </div>
        </div>
      `;
      
      document.getElementById('memeDetails').innerHTML = memeHtml;
      document.getElementById('memeContent').classList.remove('hidden');
    }

    // Function to show Team Records
    function showTeamRecords() {
      // Use cached records if available, otherwise calculate fresh
      const records = cachedRecords || calculateTeamRecords();
      
      if (!cachedRecords) {
        console.log('⚠️ No cached records found, calculating fresh records');
        cachedRecords = records; // Cache for next time
      } else {
        console.log('✅ Using pre-calculated cached records');
      }
      
      const recordsHtml = `
        <div class="records-grid">
          <div class="record-card">
            <div class="record-trophy">🏆</div>
            <div class="record-title">Highest Single Match Damage</div>
            <div class="record-holder">${records.topDamage.player}</div>
            <div class="record-value">${records.topDamage.value.toLocaleString()}</div>
            <div class="record-date">📅 ${records.topDamage.date}</div>
          </div>
          
          <div class="record-card">
            <div class="record-trophy">💀</div>
            <div class="record-title">Most Kills in One Match</div>
            <div class="record-holder">${records.topKills.player}</div>
            <div class="record-value">${records.topKills.value}</div>
            <div class="record-date">📅 ${records.topKills.date}</div>
          </div>
          
          <div class="record-card">
            <div class="record-trophy">🎯</div>
            <div class="record-title">Best Team Damage Combined</div>
            <div class="record-holder">Team Record</div>
            <div class="record-value">${records.teamDamage.value.toLocaleString()}</div>
            <div class="record-date">📅 ${records.teamDamage.date}</div>
          </div>
          
          <div class="record-card">
            <div class="record-trophy">💊</div>
            <div class="record-title">Most Revives in One Match</div>
            <div class="record-holder">${records.topRevives.player}</div>
            <div class="record-value">${records.topRevives.value}</div>
            <div class="record-date">📅 ${records.topRevives.date}</div>
          </div>
          
          <div class="record-card">
            <div class="record-trophy">🏥</div>
            <div class="record-title">Healing Champion</div>
            <div class="record-holder">${records.topHeals.player}</div>
            <div class="record-value">${records.topHeals.value}</div>
            <div class="record-date">📅 ${records.topHeals.date}</div>
          </div>
          
          <div class="record-card">
            <div class="record-trophy">🚀</div>
            <div class="record-title">Boost Master</div>
            <div class="record-holder">${records.topBoosts.player}</div>
            <div class="record-value">${records.topBoosts.value}</div>
            <div class="record-date">📅 ${records.topBoosts.date}</div>
          </div>
        </div>
      `;
      
      document.getElementById('recordsDetails').innerHTML = recordsHtml;
      document.getElementById('recordsContent').classList.remove('hidden');
    }

    // Function to show changelog
    function showChangelog() {
      const changelogHtml = `
        <div style="max-width: 800px; margin: 0 auto;">
          <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
            <h3 style="color: #333; margin-top: 0;">📋 PUBG Tracker Development History</h3>
            <p style="color: #666; margin-bottom: 0;">Track the evolution of your favorite PUBG performance dashboard!</p>
          </div>
          
          <div style="border-left: 4px solid #ff6b6b; padding-left: 20px; margin-bottom: 30px;">
            <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="color: #ff6b6b; margin: 0;">Version 1.4 - Welcome Screen & Player Stats Upgrade 🎯</h4>
                <span style="background: #ff6b6b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">27.10.2025</span>
              </div>
              <ul style="margin: 10px 0; color: #333;">
                <li><strong>Enhanced Welcome Screen:</strong> Side-by-side Quick Start Guide and Known Issues sections</li>
                <li><strong>Updated Known Issues:</strong> Added Filtered Data explanation and Error Recovery guidance</li>
                <li><strong>Sync Times Section:</strong> Renamed from Pro Tip, now shows 4 daily collection times (8-11 PM)</li>
                <li><strong>Wider Special Buttons:</strong> Meme Dashboard, Team Records, and Changelog buttons increased to 250px</li>
                <li><strong>Centered Header Layout:</strong> Fixed header alignment with balanced flex layout (1:2:1 ratio)</li>
                <li><strong>Navigation Guide:</strong> Added helpful message between player stats and day selection</li>
                <li><strong>Special Weapon Tracking:</strong> Kilma9 now tracks Crossbow & Pistol kills, Baron_Frajeris tracks Mortar kills & damage</li>
                <li><strong>Weapon Kills Data Collection:</strong> Updated PUBG.js to collect weaponKills from telemetry data</li>
                <li><strong>Streamlined Controls:</strong> Removed duplicate special section buttons from filters area</li>
                <li><strong>UI Polish:</strong> Consistent spacing, better visual hierarchy, improved user flow</li>
              </ul>
              <div style="background: #ffe3e3; border-radius: 4px; padding: 10px; margin-top: 15px;">
                <small style="color: #c92a2a;">
                  <strong>New Tracking:</strong> Kilma9's Crossbow/Pistol mastery and Baron_Frajeris's Mortar expertise are now tracked! 
                  Re-collect data to see detailed kill statistics for these special weapons.
                </small>
              </div>
            </div>
          </div>
          
          <div style="border-left: 4px solid #3498db; padding-left: 20px; margin-bottom: 30px;">
            <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="color: #3498db; margin: 0;">Version 1.3 - Data Quality & UX Enhancements 📊</h4>
                <span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">25.10.2025</span>
              </div>
              <ul style="margin: 10px 0; color: #333;">
                <li><strong>Incremental Data Collection:</strong> 80-90% faster updates - only processes new matches</li>
                <li><strong>All-Players Comparison Chart:</strong> Daily damage averages for all 6 squad members</li>
                <li><strong>Interactive Time Filters:</strong> View data by 1 day, 7 days, 14 days, or 30 days</li>
                <li><strong>Grouped Bar Charts:</strong> Better visual comparison of daily performance</li>
                <li><strong>Anomaly Detection:</strong> Filters corrupted weapon damage from PUBG API</li>
                <li><strong>Daily Averaging:</strong> Changed from per-match to per-day calculations</li>
                <li><strong>Clear Day Button:</strong> Easy navigation back to player statistics</li>
                <li><strong>Improved Navigation:</strong> Click same player button to return to Career Stats</li>
                <li><strong>Compact Welcome Screen:</strong> Better space utilization</li>
                <li><strong>Bug Fixes:</strong> First-click player loading, navigation stuck issues</li>
              </ul>
              <div style="background: #d6eaf8; border-radius: 4px; padding: 10px; margin-top: 15px;">
                <small style="color: #21618c;">
                  <strong>Performance Boost:</strong> Data collection now takes 1-2 minutes instead of 10 minutes! 
                  30-day rolling window with smart incremental updates.
                </small>
              </div>
            </div>
          </div>
          
          <div style="border-left: 4px solid #6f42c1; padding-left: 20px; margin-bottom: 30px;">
            <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="color: #6f42c1; margin: 0;">Version 1.2 - Multi-Player Dashboard 🎮</h4>
                <span style="background: #6f42c1; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">25.10.2025</span>
              </div>
              <ul style="margin: 10px 0; color: #333;">
                <li><strong>Multi-Player Support:</strong> Dashboard now supports all 6 squad members with individual data files</li>
                <li><strong>Welcome Screen:</strong> Clean first-load experience with quick start guide</li>
                <li><strong>Player Profiles:</strong> Each player has custom icon, role, and bio</li>
                <li><strong>Enhanced Filtering:</strong> Proper team size (solo/duo/squad) and composition filtering</li>
                <li><strong>Improved Layout:</strong> Wider dashboard, BIO section repositioned for better space utilization</li>
                <li><strong>Smart Data Management:</strong> Separate filtered vs global datasets for accurate statistics</li>
                <li><strong>UX Polish:</strong> Daily summary auto-hides when viewing match details</li>
                <li><strong>Bug Fixes:</strong> Fixed team size filtering, null reference errors, and special button validation</li>
              </ul>
              <div style="background: #e7d4f7; border-radius: 4px; padding: 10px; margin-top: 15px;">
                <small style="color: #6f42c1;">
                  <strong>Team Roster:</strong> Now tracking Kilma9, Mar-0, Hyottokko, Baron_Frajeris, codufus, and Veru_13!
                  Each player's stats are collected independently with individual data files.
                </small>
              </div>
            </div>
          </div>
          
          <div style="border-left: 4px solid #e67e22; padding-left: 20px; margin-bottom: 30px;">
            <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="color: #e67e22; margin: 0;">Version 1.1 🔔</h4>
                <span style="background: #e67e22; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">19.10.2025</span>
              </div>
              <ul style="margin: 10px 0; color: #333;">
                <li><strong>Discord Integration:</strong> Real-time match notifications to Discord channel</li>
                <li><strong>Smart Detection:</strong> Automatic new match detection every 10 minutes</li>
                <li><strong>Rich Notifications:</strong> Performance stats, team composition, and match details</li>
                <li><strong>Duplicate Prevention:</strong> State tracking prevents duplicate notifications</li>
                <li><strong>Enhanced Records:</strong> Automatic record recalculation with every data sync</li>
                <li><strong>UI Improvements:</strong> Separate buttons for special sections, date/time in records</li>
                <li><strong>Real Sync Timestamps:</strong> Display actual GitHub Actions execution time</li>
              </ul>
              <div style="background: #fff3cd; border-radius: 4px; padding: 10px; margin-top: 15px;">
                <small style="color: #856404;">
                  <strong>New Feature Highlight:</strong> Get instant Discord notifications when you finish a PUBG match! 
                  Rich embeds show kills, damage, placement, teammates, and match timing in Prague timezone.
                </small>
              </div>
            </div>
          </div>
          
          <div style="border-left: 4px solid #28a745; padding-left: 20px; margin-bottom: 30px;">
            <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="color: #28a745; margin: 0;">Version 1.0 🎉</h4>
                <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">18.10.2025</span>
              </div>
              <ul style="margin: 10px 0; color: #333;">
                <li><strong>Initial Release:</strong> Complete PUBG performance tracking dashboard</li>
                <li><strong>Core Features:</strong> Daily summaries, match details, weapon analytics</li>
                <li><strong>Team System:</strong> Composition filtering and player statistics</li>
                <li><strong>Player BIOs:</strong> Humorous player profiles with favorite weapons</li>
                <li><strong>Special Sections:</strong> Meme dashboard and team records</li>
                <li><strong>Automation:</strong> Scheduled data collection via GitHub Actions</li>
                <li><strong>Deployment:</strong> Automated CI/CD pipeline to webzdarma.cz hosting</li>
                <li><strong>Cache Management:</strong> Smart data refresh and sync tracking</li>
              </ul>
              <div style="background: #f8f9fa; border-radius: 4px; padding: 10px; margin-top: 15px;">
                <small style="color: #666;">
                  <strong>Technical Stack:</strong> HTML5, JavaScript ES6, Chart.js, Node.js, PUBG API, GitHub Actions
                </small>
              </div>
            </div>
          </div>
          
          <div style="text-align: center; color: #666; font-style: italic;">
            <small>🚀 Latest: Version 1.4 - Special weapon tracking & enhanced welcome screen with navigation improvements!</small>
          </div>
        </div>
      `;
      
      document.getElementById('changelogDetails').innerHTML = changelogHtml;
      document.getElementById('changelogContent').classList.remove('hidden');
    }

    // Function to calculate meme statistics
    function calculateMemeStats() {
      if (!fullMatchData || fullMatchData.length === 0) {
        return {
          mostRevives: 'Unknown',
          topDamager: 'Unknown',
          killStealer: 'Unknown'
        };
      }

      const playerStats = {};
      fullMatchData.forEach(match => {
        match.team.forEach(player => {
          if (!playerStats[player.name]) {
            playerStats[player.name] = { 
              revives: 0, damage: 0, kills: 0, matches: 0 
            };
          }
          playerStats[player.name].revives += player.revives || 0;
          playerStats[player.name].damage += player.damage || 0;
          playerStats[player.name].kills += player.kills || 0;
          playerStats[player.name].matches++;
        });
      });

      const mostRevives = Object.entries(playerStats)
        .sort((a, b) => b[1].revives - a[1].revives)[0]?.[0] || 'Unknown';
      
      const topDamager = Object.entries(playerStats)
        .sort((a, b) => b[1].damage - a[1].damage)[0]?.[0] || 'Unknown';
      
      const killStealer = Object.entries(playerStats)
        .sort((a, b) => {
          const aRatio = a[1].kills / Math.max(a[1].damage, 1);
          const bRatio = b[1].kills / Math.max(b[1].damage, 1);
          return bRatio - aRatio;
        })[0]?.[0] || 'Unknown';

      return { mostRevives, topDamager, killStealer };
    }

    // Function to calculate team records
    function calculateTeamRecords() {
      if (!fullMatchData || fullMatchData.length === 0) {
        return {
          topDamage: { player: 'Unknown', value: 0, date: 'N/A' },
          topKills: { player: 'Unknown', value: 0, date: 'N/A' },
          teamDamage: { value: 0, date: 'N/A' },
          topRevives: { player: 'Unknown', value: 0, date: 'N/A' },
          topHeals: { player: 'Unknown', value: 0, date: 'N/A' },
          topBoosts: { player: 'Unknown', value: 0, date: 'N/A' }
        };
      }

      // Only track records for our 6 squad members
      const trackedPlayers = ['Kilma9', 'Mar-0', 'Hyottokko', 'Baron_Frajeris', 'codufus', 'Veru_13'];

      let topDamage = { player: '', value: 0, date: '' };
      let topKills = { player: '', value: 0, date: '' };
      let teamDamage = { value: 0, date: '' };
      let topRevives = { player: '', value: 0, date: '' };
      let topHeals = { player: '', value: 0, date: '' };
      let topBoosts = { player: '', value: 0, date: '' };

      fullMatchData.forEach(match => {
        let matchTeamDamage = 0;
        const matchDate = new Date(match.date).toLocaleDateString('en-GB', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        match.team.forEach(player => {
          // Only track records for our 6 tracked players
          if (!trackedPlayers.includes(player.name)) {
            return; // Skip this player
          }

          // Track individual records with dates
          if (player.damage > topDamage.value) {
            topDamage = { player: player.name, value: player.damage, date: matchDate };
          }
          if (player.kills > topKills.value) {
            topKills = { player: player.name, value: player.kills, date: matchDate };
          }
          if (player.revives > topRevives.value) {
            topRevives = { player: player.name, value: player.revives, date: matchDate };
          }
          if (player.heals > topHeals.value) {
            topHeals = { player: player.name, value: player.heals, date: matchDate };
          }
          if (player.boosts > topBoosts.value) {
            topBoosts = { player: player.name, value: player.boosts, date: matchDate };
          }
          
          matchTeamDamage += player.damage || 0;
        });
        
        if (matchTeamDamage > teamDamage.value) {
          teamDamage = { value: matchTeamDamage, date: matchDate };
        }
      });

      return { topDamage, topKills, teamDamage, topRevives, topHeals, topBoosts };
    }
  </script>
</body>
</html>