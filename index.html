<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PUBG Tracker Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      padding: 20px;
      margin: 0;
      box-sizing: border-box;
      background-color: #f5f5f5;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .controls {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .dropdown-container {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    select {
      padding: 10px 15px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      background: white;
      cursor: pointer;
    }
    
    select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .content-section {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      overflow: hidden;
    }
    
    .section-header {
      background: #667eea;
      color: white;
      padding: 15px 20px;
      font-weight: bold;
      font-size: 18px;
    }
    
    .section-content {
      padding: 20px;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-container {
      background: white;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 15px;
      position: relative;
      height: 300px;
    }
    
    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .stat-title {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    
    .hidden {
      display: none !important;
    }
    
    canvas {
      width: 100% !important;
      height: 100% !important;
    }
    
    .weapons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .weapon-chart {
      height: 250px;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸŽ® PUBG Performance Dashboard</h1>
    <p>Track your team's performance with detailed statistics and weapon analytics</p>
  </div>
  
  <div class="controls">
    <div class="dropdown-container">
      <label><strong>Select Day:</strong></label>
      <select id="daySelect">
        <option value="">Choose a day...</option>
      </select>
      
      <label><strong>Select Match:</strong></label>
      <select id="matchSelect" disabled>
        <option value="">Choose a match...</option>
      </select>
    </div>
  </div>
  
  <div id="dayContent" class="content-section hidden">
    <div class="section-header">Daily Summary</div>
    <div class="section-content">
      <div id="daySummary"></div>
      <div id="dayCharts"></div>
    </div>
  </div>
  
  <div id="matchContent" class="content-section hidden">
    <div class="section-header">Match Details</div>
    <div class="section-content">
      <div id="matchSummary"></div>
      <div id="matchCharts"></div>
    </div>
  </div>

  <script>
    let matchData = [];
    let currentCharts = [];

    // Utility function to clean weapon names
    function cleanWeaponName(weapon) {
      return weapon.replace(/^(Weap |Proj )/i, '').replace(/_/g, ' ').trim();
    }

    // Utility function to destroy existing charts
    function destroyCharts() {
      currentCharts.forEach(chart => {
        if (chart && typeof chart.destroy === 'function') {
          chart.destroy();
        }
      });
      currentCharts = [];
    }

    // Load and process data
    fetch('/data.json')
      .then(res => res.json())
      .then(data => {
        matchData = data;
        populateDayDropdown();
      })
      .catch(error => {
        console.error('Error loading data:', error);
      });

    function populateDayDropdown() {
      const daySelect = document.getElementById('daySelect');
      const days = [...new Set(matchData.map(match => match.date.split('T')[0]))].sort().reverse();
      
      days.forEach(day => {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day;
        daySelect.appendChild(option);
      });
    }

    function populateMatchDropdown(selectedDay) {
      const matchSelect = document.getElementById('matchSelect');
      matchSelect.innerHTML = '<option value="">Choose a match...</option>';
      
      const dayMatches = matchData.filter(match => match.date.split('T')[0] === selectedDay);
      dayMatches.forEach((match, index) => {
        const option = document.createElement('option');
        option.value = index.toString();
        const time = new Date(match.date).toLocaleTimeString();
        option.textContent = `Match ${index + 1} (${time})`;
        matchSelect.appendChild(option);
      });
      
      matchSelect.disabled = dayMatches.length === 0;
    }

    function showDaySummary(day) {
      destroyCharts();
      const dayMatches = matchData.filter(match => match.date.split('T')[0] === day);
      
      // Calculate daily aggregated stats
      const playerStats = {};
      dayMatches.forEach(match => {
        match.team.forEach(player => {
          if (!playerStats[player.name]) {
            playerStats[player.name] = {
              kills: 0, damage: 0, headshots: 0, assists: 0, 
              boosts: 0, heals: 0, revives: 0, matches: 0,
              weapons: {}, weaponDamage: {}
            };
          }
          const stats = playerStats[player.name];
          stats.kills += player.kills || 0;
          stats.damage += player.damage || 0;
          stats.headshots += player.headshots || 0;
          stats.assists += player.assists || 0;
          stats.boosts += player.boosts || 0;
          stats.heals += player.heals || 0;
          stats.revives += player.revives || 0;
          stats.matches++;
          
          // Aggregate weapon damage
          Object.entries(player.weaponDamage || {}).forEach(([weapon, damage]) => {
            if (weapon.includes('Player') || weapon.includes('Effect')) return;
            const cleanName = cleanWeaponName(weapon);
            if (!stats.weaponDamage[cleanName]) stats.weaponDamage[cleanName] = 0;
            stats.weaponDamage[cleanName] += damage;
          });
        });
      });

      // Display summary stats
      const summaryHtml = `
        <div class="stats-summary">
          <div class="stat-card">
            <div class="stat-title">Total Matches</div>
            <div class="stat-value">${dayMatches.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Players</div>
            <div class="stat-value">${Object.keys(playerStats).length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Total Kills</div>
            <div class="stat-value">${Object.values(playerStats).reduce((sum, p) => sum + p.kills, 0)}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Total Damage</div>
            <div class="stat-value">${Math.round(Object.values(playerStats).reduce((sum, p) => sum + p.damage, 0)).toLocaleString()}</div>
          </div>
        </div>
      `;
      
      document.getElementById('daySummary').innerHTML = summaryHtml;

      // Create charts
      const chartsHtml = `
        <div class="charts-grid">
          <div class="chart-container"><canvas id="dayKillsChart"></canvas></div>
          <div class="chart-container"><canvas id="dayDamageChart"></canvas></div>
          <div class="chart-container"><canvas id="dayHeadshotsChart"></canvas></div>
          <div class="chart-container"><canvas id="dayAssistsChart"></canvas></div>
        </div>
        <div id="weaponCharts" class="weapons-grid"></div>
      `;
      
      document.getElementById('dayCharts').innerHTML = chartsHtml;

      const players = Object.keys(playerStats);
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      };

      // Performance charts
      currentCharts.push(new Chart(document.getElementById('dayKillsChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            label: 'Kills',
            data: players.map(p => playerStats[p].kills),
            backgroundColor: '#ff6b6b'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Total Kills' } } }
      }));

      currentCharts.push(new Chart(document.getElementById('dayDamageChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            label: 'Damage',
            data: players.map(p => Math.round(playerStats[p].damage)),
            backgroundColor: '#4ecdc4'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Total Damage' } } }
      }));

      currentCharts.push(new Chart(document.getElementById('dayHeadshotsChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            label: 'Headshots',
            data: players.map(p => playerStats[p].headshots),
            backgroundColor: '#45b7d1'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Total Headshots' } } }
      }));

      currentCharts.push(new Chart(document.getElementById('dayAssistsChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            label: 'Assists',
            data: players.map(p => playerStats[p].assists),
            backgroundColor: '#f7b731'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Total Assists' } } }
      }));

      // Weapon charts for each player
      const weaponChartsContainer = document.getElementById('weaponCharts');
      weaponChartsContainer.innerHTML = '';
      
      players.forEach(player => {
        const weapons = Object.entries(playerStats[player].weaponDamage)
          .filter(([weapon, damage]) => damage > 0)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10); // Top 10 weapons
        
        if (weapons.length > 0) {
          const chartDiv = document.createElement('div');
          chartDiv.className = 'weapon-chart';
          chartDiv.innerHTML = `<canvas id="weapon-${player}"></canvas>`;
          weaponChartsContainer.appendChild(chartDiv);
          
          currentCharts.push(new Chart(document.getElementById(`weapon-${player}`), {
            type: 'doughnut',
            data: {
              labels: weapons.map(([weapon]) => weapon),
              datasets: [{
                data: weapons.map(([_, damage]) => Math.round(damage)),
                backgroundColor: [
                  '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
                  '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43'
                ]
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: { display: true, text: `${player} - Weapon Damage` },
                legend: { position: 'bottom', labels: { boxWidth: 12, fontSize: 10 } }
              }
            }
          }));
        }
      });

      document.getElementById('dayContent').classList.remove('hidden');
    }

    function showMatchDetails(dayMatches, matchIndex) {
      destroyCharts();
      const match = dayMatches[matchIndex];
      
      // Match summary
      const summaryHtml = `
        <div class="stats-summary">
          <div class="stat-card">
            <div class="stat-title">Match Time</div>
            <div class="stat-value">${new Date(match.date).toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Team Size</div>
            <div class="stat-value">${match.team.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Team Kills</div>
            <div class="stat-value">${match.team.reduce((sum, p) => sum + (p.kills || 0), 0)}</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Team Damage</div>
            <div class="stat-value">${Math.round(match.team.reduce((sum, p) => sum + (p.damage || 0), 0)).toLocaleString()}</div>
          </div>
        </div>
      `;
      
      document.getElementById('matchSummary').innerHTML = summaryHtml;

      // Match charts
      const chartsHtml = `
        <div class="charts-grid">
          <div class="chart-container"><canvas id="matchKillsChart"></canvas></div>
          <div class="chart-container"><canvas id="matchDamageChart"></canvas></div>
          <div class="chart-container"><canvas id="matchHeadshotsChart"></canvas></div>
          <div class="chart-container"><canvas id="matchHealsChart"></canvas></div>
        </div>
        <div id="matchWeaponCharts" class="weapons-grid"></div>
      `;
      
      document.getElementById('matchCharts').innerHTML = chartsHtml;

      const players = match.team.map(p => p.name);
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      };

      // Performance charts
      currentCharts.push(new Chart(document.getElementById('matchKillsChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            data: match.team.map(p => p.kills || 0),
            backgroundColor: '#ff6b6b'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Kills' } } }
      }));

      currentCharts.push(new Chart(document.getElementById('matchDamageChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            data: match.team.map(p => Math.round(p.damage || 0)),
            backgroundColor: '#4ecdc4'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Damage' } } }
      }));

      currentCharts.push(new Chart(document.getElementById('matchHeadshotsChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            data: match.team.map(p => p.headshots || 0),
            backgroundColor: '#45b7d1'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Headshots' } } }
      }));

      currentCharts.push(new Chart(document.getElementById('matchHealsChart'), {
        type: 'bar',
        data: {
          labels: players,
          datasets: [{
            data: match.team.map(p => (p.heals || 0) + (p.boosts || 0)),
            backgroundColor: '#26de81'
          }]
        },
        options: { ...chartOptions, plugins: { ...chartOptions.plugins, title: { display: true, text: 'Heals + Boosts' } } }
      }));

      // Individual weapon charts for each player
      const weaponChartsContainer = document.getElementById('matchWeaponCharts');
      weaponChartsContainer.innerHTML = '';
      
      match.team.forEach(player => {
        const weapons = Object.entries(player.weaponDamage || {})
          .filter(([weapon, damage]) => damage > 0 && !weapon.includes('Player') && !weapon.includes('Effect'))
          .map(([weapon, damage]) => [cleanWeaponName(weapon), damage])
          .sort((a, b) => b[1] - a[1]);
        
        if (weapons.length > 0) {
          const chartDiv = document.createElement('div');
          chartDiv.className = 'weapon-chart';
          chartDiv.innerHTML = `<canvas id="match-weapon-${player.name}"></canvas>`;
          weaponChartsContainer.appendChild(chartDiv);
          
          currentCharts.push(new Chart(document.getElementById(`match-weapon-${player.name}`), {
            type: 'doughnut',
            data: {
              labels: weapons.map(([weapon]) => weapon),
              datasets: [{
                data: weapons.map(([_, damage]) => Math.round(damage)),
                backgroundColor: [
                  '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
                  '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43'
                ]
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: { display: true, text: `${player.name} - Weapon Damage` },
                legend: { position: 'bottom', labels: { boxWidth: 12, fontSize: 10 } }
              }
            }
          }));
        }
      });

      document.getElementById('matchContent').classList.remove('hidden');
    }

    // Event listeners
    document.getElementById('daySelect').addEventListener('change', function() {
      const selectedDay = this.value;
      
      if (selectedDay) {
        populateMatchDropdown(selectedDay);
        showDaySummary(selectedDay);
        document.getElementById('matchContent').classList.add('hidden');
      } else {
        document.getElementById('matchSelect').disabled = true;
        document.getElementById('dayContent').classList.add('hidden');
        document.getElementById('matchContent').classList.add('hidden');
      }
    });

    document.getElementById('matchSelect').addEventListener('change', function() {
      const selectedDay = document.getElementById('daySelect').value;
      const matchIndex = parseInt(this.value);
      
      if (!isNaN(matchIndex) && selectedDay) {
        const dayMatches = matchData.filter(match => match.date.split('T')[0] === selectedDay);
        showMatchDetails(dayMatches, matchIndex);
      } else {
        document.getElementById('matchContent').classList.add('hidden');
      }
    });
  </script>
</body>
</html>